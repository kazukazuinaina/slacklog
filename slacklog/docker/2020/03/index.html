---
# vim:set ts=2 sts=2 sw=2 et:
layout: slacklog
title: vim-jp.slack.com log - &#35docker - 2020年03月
---
<div>
<h2><a href='{{ post.url }}'>{{ page.title }}</a></h2>

<p>参加方法、各チャンネルの概要等は以下を参照して下さい。<br>
<a href='/docs/chat.html'>vim-jpのチャットルームについて</a></p>

{% raw %}
<pre>raa0121 1584328214.016900: Dockerfile 内で、
```RUN mkdir /usr/src/app &amp;&amp; \
    apk update &amp;&amp; \
    apk add --virtual .build build-base openssl-dev curl &amp;&amp; \
    curl -LO <https://github.com/mattn/goreman/releases/download/v0.3.4/goreman_linux_amd64.zip> &amp;&amp; \
    unzip -d /usr/local/bin goreman_linux_amd64.zip &amp;&amp; \
    rm goreman_linux_amd64.zip &amp;&amp; \
    chmod 755 /usr/local/bin/goreman```
しても、 `sh: goreman: not found` って言われるんですが、なにか知見をお持ちの方いらっしゃいませんか？</pre>
<pre>raa0121 1584328376.017700: あ、ローカルと docker で ldd の結果が違う…
```$ ldd goreman
        linux-vdso.so.1 (0x00007ffdda76f000)
        libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f5fedb23000)
        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f5fed732000)
        /lib64/ld-linux-x86-64.so.2 (0x00007f5fedd42000)```
```# ldd /usr/local/bin/goreman
        /lib64/ld-linux-x86-64.so.2 (0x7fd3133af000)
        libpthread.so.0 =&gt; /lib64/ld-linux-x86-64.so.2 (0x7fd3133af000)
        libc.so.6 =&gt; /lib64/ld-linux-x86-64.so.2 (0x7fd3133af000)```</pre>
<pre>kuu 1584328395.018200: alpineですよね、あれlibcが違うんで</pre>
<pre>lambdalisue 1584328402.018500: aline って musl jya</pre>
<pre>lambdalisue 1584328449.019100: alpine ベースの golang でビルドして `COPY --from=builder` するのがよさそう</pre>
<pre>raa0121 1584328480.019700: んー そこまでするんだったら、foreman そのまま使ってもいいかも…？</pre>
<pre>lambdalisue 1584328517.020000: ファイルサイズを気にしているのではなく？</pre>
<pre>raa0121 1584328532.020700: Ruby なプロジェクトなので、内部に、ruby があるんですよね</pre>
<pre>lambdalisue 1584328541.021000: ファイルサイズ気にしないなら alpine じゃなくて ubuntu 使えば良いのでは感</pre>
<pre>lambdalisue 1584328554.021300: (ubuntu もけっこうちいさいし)</pre>
<pre>lambdalisue 1584328558.021500: あーなるほど</pre>
<pre>lambdalisue 1584328571.021800: ruby あんなら foreman でよいのではw</pre>
<pre>lambdalisue 1584328637.022300: 個人的には alpine で消耗するくらいならベース ubuntu にしちゃえばいいじゃん派</pre>
<pre>kuu 1584328683.023200: alpineで遊んでた時にそのへんの知見それなりに得たけどそんなに役に立たない</pre>
<pre>lambdalisue 1584328686.023400: Ubuntu 新しめのだと 30 MB 切るし、十分じゃね感ある</pre>
<pre>lambdalisue 1584328712.024400: Windows container 使ってる側からすると Linux 全部誤差</pre>
<pre>raa0121 1584328721.024600: 手が勝手に、 `FROM hoge-x.x-alpine` って打ってしまって…</pre>
<pre>lambdalisue 1584328733.024800: www</pre>
<pre>thinca 1584328786.025100: thinca/vim は alpine で 14MB</pre>
<pre>lambdalisue 1584328794.025500: つおい</pre>
<pre>mattn 1584328849.026600: alpine 好きー、あるぱぃんすきー、あるぺんすきー、アルペンスキー！</pre>
<pre>lambdalisue 1584328866.026900: Windowsバイナリコンパイルようイメージが 15 GB ある</pre>
<pre>lambdalisue 1584328883.027300: なので単位が MB の時点で僕にっては誤差</pre>
<pre> 1584328922.027500: docker images の出力（一部）</pre>
<pre>mattn 1584328933.028000: Windows Container、問題ばっかりでて辛そう。</pre>
<pre>lambdalisue 1584328944.028300: 実際無茶苦茶辛いです</pre>
<pre>raa0121 1584328998.030400: さっき、docker image prune -a したら、40.2GB 空いたんだど、その一覧見ると、そこまで感ある</pre>
<pre>johejo 1584329024.031700: ubuntuはデフォルトだとmirrorが遅いからalpineが面倒なときはdebian slimをよく使ってます</pre>
<pre>mattn 1584329028.032000: 何 TB のディスク使ってるんだろう。</pre>
<pre>lambdalisue 1584329028.032100: （上記はダブってるので全部の足し算ではないですよー）</pre>
<pre>tsuyoshi_cho 1584329042.032400: 現状、できあいのツールをホストするコンテナとしてしか使い~憎い~難いですねえ...</pre>
<pre>lambdalisue 1584329071.032900: Windows 版のバイナリ作るのに便利ではあるんですよ...</pre>
<pre>tsuyoshi_cho 1584329091.033500: まあ、がんばる価値はあるとは思います..</pre>
<pre>kuu 1584329115.033900: 自宅CIみたいな</pre>
<pre>raa0121 1584329117.034000: ライセンスってどうなんです？</pre>
<pre>lambdalisue 1584329172.034900: <https://docs.microsoft.com/ja-jp/virtualization/windowscontainers/about/faq#how-are-containers-licensed-is-there-a-limit-to-the-number-of-containers-i-can-run|ライセンス ></pre>
<pre>raa0121 1584329216.035300: 強い</pre>
<pre>mattn 1584329238.035500: あくまでコンテナの話。</pre>
<pre>mattn 1584329268.036000: VPS とかで寝かせるとそれはそれで掛かる。</pre>
<pre>johejo 1584329321.037100: kubernetesもいちおうwindowsコンテナサポートしてるらしい。どれくらい使われているかは知らない...</pre>
<pre>lambdalisue 1584329356.037700: Windows コンテナ実行するのに Windows が必要なのが面倒なんですよねぇ。まぁ当たり前っちゃ当たり前ですが</pre>
<pre>mattn 1584329551.039000: Windows、クラウドで寝かせててもライセンス料かかるのが微妙にお高くなってる程度に使ってます。</pre>
<pre>koron 1584330500.039400: `RUN apk add --no-cache ca-certificates libc6-compat` goでビルドしたバイナリをalpineで使うときのおまじない</pre>
<pre>lambdalisue 1584330576.039900: `libc6-compat` なんて便利なものがあるのかー</pre>
<pre>koron 1584330611.040500: これやるとcircleci/goでビルドしたバイナリがalpineで動く</pre>
<pre>johejo 1584331557.041800: CGO_ENABLED=0 でpure Go実装を使うのとlibcのgetaddrinfo(3)をつかうのってどっちがいいんだろうか...</pre>
<pre>ycino 1584332997.042700: alpineのRuby、バグが残ってそうなんでUbuntuの方がいい気がします</pre>
<pre>ycino 1584333025.042900: 解決してないんじゃないかなぁこれ
<https://bugs.ruby-lang.org/issues/14387></pre>
<pre>tennashi 1584333229.043500: <https://www.slideshare.net/yaegashi/golang-binary-hacks-150386886>
これと似たような話っぽい...?</pre>
<pre>kuu 1584333422.043900: 話全然関係ないけど一瞬ヤエガッシーさんかと思った</pre>
<pre>k-takata 1584337661.045200: へえ、WindowsのPE形式だとデフォルトのスタックサイズなどを設定できるけど、ELF形式にも同じような機能あるんだ。</pre>
<pre>tyru 1584722183.048300: 自宅サーバを docker で管理したくて、ノードは2台でこのコンテナはこっち（ノードA）、このコンテンツはこっち（ノードB）みたいに設定や CLI から指定したいです。
こういうのやるには k8s とかがいいんでしょうか</pre>
<pre>johejo 1584722744.052200: その用途だとまさにk8sですね 
nodeSelectorとかAffinityで特定のノードにpodを寄せられますね。
ただステートフルな要素（ストレージとか）が絡んでくると色々めんどくさいとは思います。</pre>
<pre>tyru 1584723016.054300: なるほど
ストレージは RAID 付きの HDD ケース（裸族の～みたいなやつとか）につないでファイルサーバのデータもコンテナのデータもなんもかんもそこにぶっこもうと思ってます（自宅サーバで mdadm とか LVM とかもう疲れちゃった…）</pre>
<pre>tyru 1584723116.056400: 2台体制で冗長化してサービスごとに分けようかと思ってます… いやユーザ数=1なんだから負荷考えなくてよくて夜中にまとめてバックアップとかでもいいんだよな…うーん</pre>
<pre>johejo 1584723221.057800: 個人的にはよっぽどのこと（GPU付きノードに載せないといけないとか）がない限り特定のノードに寄せずにk8sのスケジューラに全部おまかせでいいんじゃないかと思ってます。</pre>
<pre>johejo 1584723423.059300: （自宅サーバにk8sは明らかにオーバースペックなので学習/管理コストのほうが上回るとは思います...）</pre>
<pre>tyru 1584723460.059700: （正直学習も兼ねてます…）</pre>
<pre>johejo 1584723614.062100: いきなり自前クラスタは構築から難易度高いのでマネージドとかkind, minikubeで慣れてからが良いと思います。マネージドも面倒みるの結構大変...</pre>
<pre>tyru 1584723697.062800: おお、見てみます。正直学習も兼ねてるとはいえ自宅サーバ復活の目的の方が大きいので…</pre>
<pre>tyru 1584723723.063200: スケジューラって無効にして手動でノード指定もできたりします？</pre>
<pre>johejo 1584723850.064500: 無効はできるのか... ちょっとわかりません... このラベルのついたnodeに置いてくれってスケジューラにお願いする感じです</pre>
<pre>tyru 1584723952.065600: ふむふむ
2台に active, standby 割り当てて全部 active に置けばよさそう？</pre>
<pre>tyru 1584724050.067800: もうなんかディストリビューションというかベアメタルというか、インストールしさえすればシュッと k8s 環境が手に入るならそれでもいい（学習も兼ねている、とは…）</pre>
<pre>tyru 1584724250.068400: いや流石にハマった時つらいか…</pre>
<pre>tyru 1584724754.069300: ここらへん本当覚えることがかなり多いなー
明日また調べてみます。ありがとうございました</pre>
<pre>tennashi 1584728116.070200: docker swarm でもよさそう</pre>
<pre>tyru 1584730915.070300: なんか全てが k8s になってってる印象なんですがどうなんでしょう…</pre>
<pre>koron 1584754208.000400: nomad 使ってるところもありますお</pre>
<pre>koron 1584754233.000600: <https://nomadproject.io/></pre>
<pre>ycino 1584770122.001000: これちょうどよさそう？ <https://k8slens.dev/></pre>
<pre>johejo 1584773473.001700: gui版k9sか <https://github.com/derailed/k9s|https://github.com/derailed/k9s></pre>
<pre>tyru 1584774423.002700: おー全部知らなかった… それぞれ Web UI / GUI / TUI ついてるのか
調べてみます</pre>
<pre>vikke 1584922682.003900: ここって、dockerに関する質問しても良いのかしら。それともvimと絡んでないと駄目？</pre>
<pre>mattn 1584922903.004200: 絡んでなくても全然かまいません。</pre>
<pre>vikke 1584923518.008600: ```FROM php:7.2-fpm-alpine

RUN apk --update add --no-cache build-base autoconf freetype-dev libpng-dev libjpeg-turbo-dev
RUN docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \
    &amp;&amp; docker-php-ext-install -j$(nproc) gd mysqli pdo_mysql```
こんなDockerfileを、macでbuildすると成功して、ArchLinuxでbuildすると、
```rm: can't remove '/usr/src/php/sapi/phpdbg/tests': Directory not empty
rm: can't remove '/usr/src/php/ext/standard/tests/network': Directory not empty
rm: can't remove '/usr/src/php/ext/standard/tests/url': Directory not empty
rm: can't remove '/usr/src/php/ext/mysqlnd': Directory not empty
rm: can't remove '/usr/src/php/ext/phar/tests/tar/files': Directory not empty
rm: can't remove '/usr/src/php/ext/phar/tests/cache_list/files': Directory not empty
rm: can't remove '/usr/src/php/ext/mbstring/oniguruma/src': Directory not empty
rm: can't remove '/usr/src/php/ext/hash/tests': Directory not empty
rm: can't remove '/usr/src/php/ext/gmp/tests': Directory not empty
rm: can't remove '/usr/src/php/ext/xsl/tests': Directory not empty
rm: can't remove '/usr/src/php/ext/gd/libgd': Directory not empty
rm: can't remove '/usr/src/php/ext/soap/tests/soap12': Directory not empty
rm: can't remove '/usr/src/php/ext/soap/tests/interop/Round3/GroupD': Directory not empty
rm: can't remove '/usr/src/php/Zend/tests/return_types': Directory not empty
rm: can't remove '/usr/src/php/tests/output': Directory not empty```
と怒られます。
実際、macでは、/usr/src/php.tar.xzと、php.tar.xz.ascしか無いですが、Archの方は、php.tar.xzが展開さて、php directoryが存在している状態になってます。
これってどういう現象でしょうか。というか、`docker-php-ext-configure`でphp.tar.xzが展開されているのはわかったのですが、どう対処したら良いのかわかりません。
どなたか智恵を。</pre>
<pre> 1584925688.009100: Ubuntuですが、そのまま行けましたね</pre>
<pre>ゴリラ 1584925759.009700: Dockerの環境の差分があるのかなぁ</pre>
<pre>ゴリラ 1584925829.010200: ArchのDockerのバージョンはMacと同じですか？</pre>
<pre>vikke 1584925873.010700: 一緒ですね。19.03.8です。</pre>
<pre>vikke 1584925881.011100: なんだろう。</pre>
<pre>tsuyoshi_cho 1584925950.012100: 冪等性を考えると、phpのセットアップをホストの機能に依存しないようにする(マルチステージビルドでPHP環境作るものを用意して、そっからimport的な)
といいのではないかという気がします</pre>
<pre>ゴリラ 1584925996.012900: あれ、ホスト依存しているんですか？</pre>
<pre>ゴリラ 1584926015.013300: Dockerfileの中身を見ているけど、依存していないように見える</pre>
<pre>tsuyoshi_cho 1584926035.013900: あ、依存ではない...か? でも docker-php-ext-configureって最初から入ってる?</pre>
<pre>vikke 1584926058.014500: alpineなので最初から入ってます。</pre>
<pre>ゴリラ 1584926059.014600: ```php:7.2-fpm-alpine```
に入っているんじゃないかなと</pre>
<pre>tsuyoshi_cho 1584926080.015300: あー、すんません検討違いでした、無視しておいてください</pre>
<pre>ゴリラ 1584926084.015400: なので、そもそもビルドで挙動が変わるのは変な感じはありますね</pre>
<pre>0Δ 1584926097.015800: バグの予感</pre>
<pre>vikke 1584926112.016100: docker-php-ext-configure のバグ?</pre>
<pre>tsuyoshi_cho 1584926122.016200: ```/usr/include/ ```
がホスト側の話かと思ってしまった...</pre>
<pre>vikke 1584926140.016700: 全部中のログですね。</pre>
<pre>tsuyoshi_cho 1584926163.017300: そりゃそうですよね、謎だなあ</pre>
<pre>ゴリラ 1584926165.017500: docker-php-ext-configure の 中身を除くと良いかもですね
ディレクトリが展開される契機はなにか、を知れば差分をしれそう</pre>
<pre>ゴリラ 1584926204.018100: もしくはMacとArchのビルドログを比較して、どこで差分出ているのか</pre>
<pre>ゴリラ 1584926211.018300: を見るのが早いかも</pre>
<pre>ゴリラ 1584926252.019100: 何かしらの判定があってディレクトリ展開しているなら、その判定条件が差分なはずなので、
その判定条件を調べるって感じですかね</pre>
<pre>vikke 1584926296.019700: ただ、中から、外って見えないですよね。外が何かの判定って出来るのかな。</pre>
<pre>vikke 1584926316.020000: とりあえずdocker-php-ext-configure追ってみます。</pre>
<pre>tsuyoshi_cho 1584926355.021000: (RUNしかしてませんしねえ ADD/COPYもないので、初回のルート取り込みくらいだし、それも同じはず)</pre>
<pre>vikke 1584926415.021500: 夢であってほしい。</pre>
<pre>vikke 1584926796.022000: ```Installing shared extensions:     /usr/local/lib/php/extensions/no-debug-non-zts-20170718/
find . -name \*.gcno -o -name \*.gcda | xargs rm -f
find . -name \*.lo -o -name \*.o | xargs rm -f
find . -name \*.la -o -name \*.a | xargs rm -f
find . -name \*.so | xargs rm -f
find . -name .libs -a -type d|xargs rm -rf
rm -f <http://libphp.la|libphp.la>       modules/* libs/*
WARNING: Ignoring APKINDEX.70f61090.tar.gz: No such file or directory
WARNING: Ignoring APKINDEX.ca2fea5b.tar.gz: No such file or directory
(1/4) Purging .phpize-deps-configure (20200323.012316)
(2/4) Purging dpkg-dev (1.19.7-r1)
(3/4) Purging dpkg (1.19.7-r1)
(4/4) Purging re2c (1.3-r0)
Executing busybox-1.31.1-r9.trigger
OK: 226 MiB in 60 packages
Removing intermediate container c1f923c5bf9c
 ---&gt; 4df79b02e0ff
Successfully built 4df79b02e0ff
Successfully tagged lastest:latest```
こっちmacのログ.</pre>
<pre>vikke 1584926852.022700: ```Installing shared extensions:     /usr/local/lib/php/extensions/no-debug-non-zts-20170718/
find . -name \*.gcno -o -name \*.gcda | xargs rm -f
find . -name \*.lo -o -name \*.o | xargs rm -f
find . -name \*.la -o -name \*.a | xargs rm -f
find . -name \*.so | xargs rm -f
find . -name .libs -a -type d|xargs rm -rf
rm -f <http://libphp.la|libphp.la>       modules/* libs/*
WARNING: Ignoring APKINDEX.70f61090.tar.gz: No such file or directory
WARNING: Ignoring APKINDEX.ca2fea5b.tar.gz: No such file or directory
(1/4) Purging .phpize-deps-configure (20200323.012116)
(2/4) Purging dpkg-dev (1.19.7-r1)
(3/4) Purging dpkg (1.19.7-r1)
(4/4) Purging re2c (1.3-r0)
Executing busybox-1.31.1-r9.trigger
OK: 226 MiB in 60 packages
rm: can't remove '/usr/src/php/sapi/phpdbg/tests': Directory not empty
rm: can't remove '/usr/src/php/ext/standard/tests/network': Directory not empty
rm: can't remove '/usr/src/php/ext/standard/tests/url': Directory not empty
rm: can't remove '/usr/src/php/ext/mysqlnd': Directory not empty
rm: can't remove '/usr/src/php/ext/phar/tests/tar/files': Directory not empty
rm: can't remove '/usr/src/php/ext/phar/tests/cache_list/files': Directory not empty
rm: can't remove '/usr/src/php/ext/mbstring/oniguruma/src': Directory not empty
rm: can't remove '/usr/src/php/ext/hash/tests': Directory not empty
rm: can't remove '/usr/src/php/ext/gmp/tests': Directory not empty
rm: can't remove '/usr/src/php/ext/xsl/tests': Directory not empty
rm: can't remove '/usr/src/php/ext/gd/libgd': Directory not empty
rm: can't remove '/usr/src/php/ext/soap/tests/soap12': Directory not empty
rm: can't remove '/usr/src/php/ext/soap/tests/interop/Round3/GroupD': Directory not empty
rm: can't remove '/usr/src/php/Zend/tests/return_types': Directory not empty
rm: can't remove '/usr/src/php/tests/output': Directory not empty
The command '/bin/sh -c docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/     &amp;&amp; docker-php-ext-install -j$(nproc) gd mysqli pdo_mysql' returned a non-zero code: 1```
こっちArchLinuxのログ。</pre>
<pre>vikke 1584926873.023300: Archの方が処理終わった後に掃除しようとしてコケれるっぽい。</pre>
<pre>ゴリラ 1584926924.023700: ぱっと見、コケるまではおなじっぽい</pre>
<pre>ゴリラ 1584926928.024000: ふむ…</pre>
<pre>tsuyoshi_cho 1584926929.024100: エラー自体は、たぶんrmが `-f` がなくて失敗ですかね</pre>
<pre>tsuyoshi_cho 1584926968.025100: 逆になんでmacはファイルが先に消えてる(か生成されてないか)なのか</pre>
<pre>tsuyoshi_cho 1584927006.026100: 勝手に展開(archだけ)、はさすがにない気はする...</pre>
<pre>0Δ 1584927020.026600: あれ、archで成功してしまった……</pre>
<pre>kuu 1584927023.026900: なんか見たことある気が</pre>
<pre>ゴリラ 1584927034.027500: 成功者がいた</pre>
<pre>kuu 1584927034.027600: ファイルシステムにxfs使ってます？</pre>
<pre>kuu 1584927049.028200: もしそうならあのfs、Docker未対応です</pre>
<pre>vikke 1584927094.028400: ぎゃ、、、</pre>
<pre>vikke 1584927110.028600: ext4?</pre>
<pre>vikke 1584927125.028900: xfs使ってます。</pre>
<pre>ゴリラ 1584927140.029600: deltaさんのファイルシステムはなんだろう</pre>
<pre> 1584927147.030000: Archのログです</pre>
<pre>ゴリラ 1584927172.031300: <https://qiita.com/amatsus/items/aa2a58b0d5800312b6fa></pre>
<pre>0Δ 1584927180.032200: こっちのfsはext4ですね。</pre>
<pre>ゴリラ 1584927183.032300: これ、ファイルシステムが原因くさい</pre>
<pre>vikke 1584927220.033100: /var/lib/dockerの入っているpartitionだけext4にすれば良いのかにゃ?</pre>
<pre>vikke 1584927249.034100: (あっちこっちで質問魔)</pre>
<pre>ゴリラ 1584927252.034200: ```d_typeをサポートしないファイルシステムでOverlayするとwhiteoutファイルをDT_CHRと判定できないため、消したはずのファイル(やディレクトリ)が中途半端に見えてしまいます。```
</pre>
<pre>vikke 1584927270.035000: 完全にこれや。</pre>
<pre>kuu 1584927271.035100: それそれ、overlayfs絡みで対応してない仕様があるのでファイルの削除が認識できない</pre>
<pre>ゴリラ 1584927285.035300: コンテナが作成されるところがext4にすれば行けそうな雰囲気</pre>
<pre>ゴリラ 1584927303.035500: `/var/lib/docker`配下で良さそうな雰囲気（やったことがない）</pre>
<pre>vikke 1584927343.036300: /home 別パーティションに切ってるから、resizeして、/var/lib/dockerにmountかなー</pre>
<pre>kuu 1584927372.037000: これ、前に踏みぬいて半日くらい消えたなあ…</pre>
<pre>ゴリラ 1584927380.037200: :totemoturai:</pre>
<pre>tsuyoshi_cho 1584927392.037700: うあー</pre>
<pre>0Δ 1584927403.038100: :tiken:</pre>
<pre>vikke 1584927419.038500: これは大きな知見だ。</pre>
<pre>ゴリラ 1584927454.039400: :tiken:</pre>
<pre>vikke 1584927471.039700: linuxって、single user modeってあるんだっけ? FreeBSDだとsingle user modeで立ち上げれば、daemon走ってない、mountもされてない状況に入れるんだけど。</pre>
<pre>kuu 1584927503.040500: systemctlでdockerだけ切ってしまえばいいのでは</pre>
<pre>0Δ 1584927509.040900: それだ</pre>
<pre>tsuyoshi_cho 1584927520.041200: ありはしますが、たしかにサービス停止が無難</pre>
<pre>vikke 1584927556.041800: /homeを一端umountしないと、resize出来ないですよね?</pre>
<pre>tsuyoshi_cho 1584927581.042300: あー、homeのリサイズなら、たしかにシングルユーザーになってやったほうがよさげか</pre>
<pre>kuu 1584927639.043000: 最近はライブリサイズできるらしいが、シングルになったほうが安全な気はする</pre>
<pre>thinca 1584927720.044800: 私はこういうときなんかのインストールイメージでマシンを立ち上げちゃう</pre>
<pre>kuu 1584927733.045100: 何かしらのGUI出るライブディストロ動かしてGParted辺り入れるのが一番楽</pre>
<pre>0Δ 1584928372.045800: xfsで成功してしまったのですが()</pre>
<pre>vikke 1584928447.046100: マジデ!!!!!</pre>
<pre>vikke 1584928516.046800: ```$ cat /etc/fstab
# /dev/nvme0n1p5
UUID=2a0e38bd-15eb-4cab-9e2f-3065a494d675       /               xfs             rw,relatime,attr2,inode64,logbufs=8,logbsize=32k,noquota        0 1

# /dev/nvme0n1p6
UUID=87fa2305-8368-4c57-a93d-30d424fdca21       /home           xfs             rw,relatime,attr2,inode64,logbufs=8,logbsize=32k,noquota        0 2

# /dev/nvme0n1p2
UUID=9A1C-78D9          /boot           vfat            rw,relatime,fmask=0022,dmask=0022,codepage=437,iocharset=iso8859-1,shortname=mixed,utf8,errors=remount-ro        0 2

/swap                   none            swap            defaults        0 0```
わしのfstab。mount option、なにか違うのかな。。。</pre>
<pre>kuu 1584928822.047800: overlay使ってなければならないけどそのへん？</pre>
<pre>0Δ 1584928879.048100: こんな状況です。
```Filesystem      Size  Used Avail Use% Mounted on
dev             954M     0  954M   0% /dev
run             963M  872K  962M   1% /run
/dev/sda2       125G  8.9G  110G   8% /
tmpfs           963M     0  963M   0% /dev/shm
tmpfs           963M     0  963M   0% /sys/fs/cgroup
tmpfs           963M  7.5M  955M   1% /tmp
/dev/sda1       300M  280K  300M   1% /boot/efi
tmpfs           193M   28K  193M   1% /run/user/1000
/dev/sdb1        16G  666M   16G   5% /var/lib/docker```</pre>
<pre>0Δ 1584928944.049600: 単純に別ディスク作成して、 `/var/lib/docker` にアタッチしてdocker再起動しただけ
これだと見てくれないという事かな……</pre>
<pre>kuu 1584928961.050400: `docker info`(でしたっけ)の結果ってどうなってます？</pre>
<pre>kuu 1584928985.050800: あーそこ再マウントしてるか</pre>
<pre>0Δ 1584929000.051100: ```[zdelta@0delta-pc ~]$ docker info
Client:
 Debug Mode: false

Server:
 Containers: 0
  Running: 0
  Paused: 0
  Stopped: 0
 Images: 5
 Server Version: 19.03.5-ce
 Storage Driver: overlay2
  Backing Filesystem: xfs
  Supports d_type: true
  Native Overlay Diff: false
 Logging Driver: json-file
 Cgroup Driver: cgroupfs
 Plugins:
  Volume: local
  Network: bridge host ipvlan macvlan null overlay
  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog
 Swarm: inactive
 Runtimes: runc
 Default Runtime: runc
 Init Binary: docker-init
 containerd version: d50db0a42053864a270f648048f9a8b4f24eced3.m
 runc version: d736ef14f0288d6993a1845745d6756cfc9ddd5a
 init version: fec3683
 Security Options:
  apparmor
  seccomp
   Profile: default
 Kernel Version: 5.4.2-1-MANJARO
 Operating System: Manjaro Linux
 OSType: linux
 Architecture: x86_64
 CPUs: 3
 Total Memory: 7.391GiB
 Name: 0delta-pc
 ID: HA5E:XUXL:SLDZ:XKQJ:5AQD:3GEG:XUBS:L35M:63BI:UQM5:7L6L:RU6B
 Docker Root Dir: /var/lib/docker
 Debug Mode: false
 Registry: <https://index.docker.io/v1/>
 Labels:
 Experimental: false
 Insecure Registries:
  127.0.0.0/8
 Live Restore Enabled: false```</pre>
<pre>vikke 1584929009.051700: ```$ docker info
Client:
 Debug Mode: false

Server:
 Containers: 33
  Running: 0
  Paused: 0
  Stopped: 33
 Images: 27
 Server Version: 19.03.8-ce
 Storage Driver: overlay2
  Backing Filesystem: &lt;unknown&gt;
  Supports d_type: true
  Native Overlay Diff: false
 Logging Driver: json-file
 Cgroup Driver: cgroupfs
 Plugins:
  Volume: local
  Network: bridge host ipvlan macvlan null overlay
  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog
 Swarm: inactive
 Runtimes: runc
 Default Runtime: runc
 Init Binary: docker-init
 containerd version: d76c121f76a5fc8a462dc64594aea72fe18e1178.m
 runc version: dc9208a3303feef5b3839f4323d9beb36df0a9dd
 init version: fec3683
 Security Options:
  seccomp
   Profile: default
 Kernel Version: 5.5.10-arch1-1
 Operating System: Arch Linux
 OSType: linux
 Architecture: x86_64
 CPUs: 8
 Total Memory: 15.31GiB
 Name: ichiro
 ID: LEDM:KS55:WRHM:MCB5:YNRB:T7C5:QF7X:3LJX:OFSW:D33D:UL62:LIOX
 Docker Root Dir: /var/lib/docker
 Debug Mode: false
 Username: vikke
 Registry: <https://index.docker.io/v1/>
 Labels:
 Experimental: false
 Insecure Registries:
  127.0.0.0/8
 Live Restore Enabled: false```</pre>
<pre>raa0121 1584929024.051900: `Backing Filesystem: &lt;unknown&gt;`</pre>
<pre>0Δ 1584929029.052100: はい。このへんか
``` Storage Driver: overlay2
  Backing Filesystem: xfs
  Supports d_type: true```</pre>
<pre>0Δ 1584929090.052900: なるほど。ココで既にdockerがおかしいって言っていたのか</pre>
<pre>vikke 1584929245.053500: ```ストレージ・ドライバを設定するには dockerd コマンドで --storage-driver=&lt;名前&gt; オプションを使うか、あるいは、 /etc/default/docker ファイル中の DOCKER_OPTS 行を編集します。```
<http://docs.docker.jp/engine/userguide/storagedriver/selectadriver.html#a-pluggable-storage-driver-architecture></pre>
<pre>tsuyoshi_cho 1584929256.053800: いまはxfsもd_type trueなのか?</pre>
<pre>vikke 1584929316.054200: infoの結果がそう言ってますねー。</pre>
<pre>vikke 1584929324.054400: ぐぬぬぬぬ</pre>
<pre>vikke 1584929778.054600: `/etc/default/docker` が無い。。。</pre>
<pre>raa0121 1584929980.055700: `/etc/systemd/system/multi-user.targe.wants/docker.service` に書くのがいいかな…？</pre>
<pre>raa0121 1584930071.056100: `/etc/default/docker` だと、systemd には反映されないっぽいし</pre>
<pre>dohq 1584931356.057000: `/etc/docker/daemon.json` に書けばよいのでは</pre>
<pre>vikke 1584932333.058100: パーティションリサイズしたら、/home mount出来なくなったwww</pre>
<pre>vikke 1584938665.060200: ところで、`/etc/systemd/system/multi-user.targe.wants/docker.service`ないしは`/etc/docker/daemon.json` になんて書けば良かったんですか？後学の為に。</pre>
<pre>thinca 1584939162.060700: パーティションリサイズの前に FS のリサイズをしないと? (さすがにそこはしましたかね…)</pre>
<pre>raa0121 1584939429.060800: docker が Backing filesystem として、 xfs を認識してないので、そこに何か書いて、解決する状況じゃないかもです</pre>
<pre>dohq 1584939888.061000: storage-driver変更でやりくりするもんだと思ってたのでそれならdaemon.jsonに書けば…と思ってアレしました</pre>
<pre>vikke 1584940078.061600: <https://serverfault.com/questions/81262/how-can-you-shrink-an-xfs-filesystem>
xfs cannot be shrunk.これか。</pre>
<pre>Polly 1584944442.062500: <@U06ECBRTJ> has a poll for you!</pre>
<pre>kuu 1584944701.063300: なんも契約しとらんので必然的にHub行き</pre>
<pre>tsuyoshi_cho 1584944822.063700: これ見て、見付けた記事
<https://qiita.com/suecharo/items/a5e0cd3fe6d31443c536>
<https://qiita.com/homines22/items/6d28461d97906e42f57c></pre>
<pre>koron 1584945598.064400: 仕事では Harbor つかってる。</pre>
<pre>koron 1584945670.064700: <https://goharbor.io/></pre>
<pre>mattn 1584945981.065100: harbor ってもしかして appharbor の harbor?</pre>
<pre>mattn 1584946011.065300: 違うぽかった。</pre>
<pre>kuu 1584946310.067400: 毎回パッケージ落としてくるのが嫌で、シェルスクリプト使ってパッケージキャッシュ共有してイメージ構築してるけどこのへん上手くできないものか</pre>
<pre>johejo 1584953078.069700: 仕事はAzure縛りなのでACR プライベートはDockerHub</pre>
<pre>johejo 1584953094.070200: quay.io使ってみたい 特に使い心地は変わんないとは思うが</pre>
{% endraw %}
