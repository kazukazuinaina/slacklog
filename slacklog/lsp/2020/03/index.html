---
# vim:set ts=2 sts=2 sw=2 et:
layout: slacklog
title: vim-jp.slack.com log - &#35lsp - 2020年03月
---
<div>
<h2><a href='{{ post.url }}'>{{ page.title }}</a></h2>

<p>参加方法、各チャンネルの概要等は以下を参照して下さい。<br>
<a href='/docs/chat.html'>vim-jpのチャットルームについて</a></p>

{% raw %}
<pre>mattn 9日 00:51:22: efm、loglevel というのをひっそり足して level 5 以上なら通信内容も出力する様にしました。</pre>
<pre>thinca 9日 00:52:24: 実行したコマンドのログもあると便利そう</pre>
<pre>mattn 9日 00:54:09: 1以上で出ます。</pre>
<pre>mattn 9日 00:54:39: 5だと割ともう目grepで死ねます。</pre>
<pre>mattn 9日 00:55:43: ただ今のレベルの仕様は fixed のつもりでないのでいずれ個別に出せる様にするかもしれないです。</pre>
<pre>tsuyoshi_cho 9日 05:20:09: 対応しよう…</pre>
<pre>mattn 9日 14:54:36: homebrew に入れてみない？って issue、僕はどうしたらいいんだろう。 <https://github.com/mattn/efm-langserver/issues/23></pre>
<pre>mattn 9日 14:54:56: formula ぜんぜんわからない。</pre>
<pre>mattn 9日 14:55:08: nakamura なら知ってる。</pre>
<pre>kyoh86 9日 14:55:53: goreleaserなら</pre>
<pre>kyoh86 9日 14:55:55: 簡単にやれますよ</pre>
<pre>tsuyoshi_cho 9日 14:56:01: 勝手にformulaを投稿して採用されれば..?とか言っちゃいますか?
goだからgo getすればいいので、べつに好みじゃないかなと...(はいってたほうが嬉しいけど、メンテコストとか微妙?)</pre>
<pre>dohq 9日 14:56:11: mattnさんがmac使ってるならありかなとも思いますが
正直fomulaのメンテもしないといけないのはアレ</pre>
<pre>kyoh86 9日 14:56:15: あ、公式に載せろってことか</pre>
<pre>tsuyoshi_cho 9日 14:56:50: go系がすごく単純、とかならいいけど...</pre>
<pre>kyoh86 9日 14:59:17: `brew install mattn/tap/efm-langserver` とかでいいなら割と簡単に作れるんですけどね
そもそもオーナーがMacじゃない中で外からそれを要求するのはしんどい。

&gt; 勝手にformulaを投稿して採用されれば..?とか言っちゃ
うのが良さそう</pre>
<pre>kyoh86 9日 15:03:41: ref: 「割と簡単」な方法
<https://qiita.com/izumin5210/items/b0bd3fa21aed6ab6bef5></pre>
<pre>tsuyoshi_cho 9日 15:05:25: たとえば簡単(?)なのは、こんなか...
<https://github.com/Homebrew/homebrew-core/blob/master/Formula/gron.rb></pre>
<pre>itchyny 9日 15:14:34: `I would volunteer to write this` って書いてあるのでおまかせしますでいいんじゃないかな…</pre>
<pre>itchyny 9日 15:15:24: 新しいリリースをだした時に追従してもらえるなら…</pre>
<pre>mattn 9日 15:21:59: お願いしました。</pre>
<pre>johejo 9日 16:17:01: こういうの先に"ありがとうキミが作ってくれるんだね CIのセットアップもよろしく"とか煽ったりするとトラブルになるんだろうな...</pre>
<pre>johejo 9日 21:14:36: lsp4xml orgがeclipseにうつって名前変わってる。
<https://github.com/eclipse/lemminx|https://github.com/eclipse/lemminx></pre>
<pre>kuu 9日 21:15:39: Eclipseも今やLSPかー</pre>
<pre>johejo 9日 23:20:59: yaml-language-server format対応してないように見えるけどREADMEには対応してるように書いてある。どういうことなのかな...
<https://github.com/redhat-developer/yaml-language-server/blob/0b6739e4bf1a0d8b5a7205167f47064808041f53/src/server.ts#L358>
<https://github.com/redhat-developer/yaml-language-server#language-server-settings></pre>
<pre>h-michael 9日 23:46:02: こういうことみたいですね
<https://github.com/redhat-developer/yaml-language-server/pull/179></pre>
<pre>johejo 9日 23:50:43: すみません結局どっちなのかわかりませんでした...</pre>
<pre>h-michael 10日 00:03:05: initializeでは使えないのですがdynamicRegistrationでserver側のrequestによってあとから利用可能になるようです。</pre>
<pre>mattn 10日 00:04:46: vim-lsp、dynamicRegistration サポートしてない...</pre>
<pre>h-michael 10日 00:05:57: dynamicRegistrationなんのために仕様なのかいまいちわからない</pre>
<pre>hrsh7th 10日 00:11:40: ある処理の初期化に時間がかかる場合に使うんですかね。。。</pre>
<pre>h-michael 10日 00:12:19: yaml-language-severはprettier叩いてるだけなんで初期化もなにもないんですけどね。。。</pre>
<pre>hrsh7th 10日 00:12:59: prettier が使えそうであれば capability に追加し、そうでないなら追加しないってことなんですかねー。</pre>
<pre>hrsh7th 10日 00:13:25: なんか違いそうですね。。。</pre>
<pre>h-michael 10日 00:13:48: prettierは組み込んでいるのでclient側の環境は関係ないですね。</pre>
<pre>hrsh7th 10日 00:14:28: workspace/didChangeConfiguration で `format.enable` をもらう都合、initialize のレスポンスに「format 対応してます。」と打ち返せないタイミング的な問題だと理解しました。</pre>
<pre>johejo 10日 00:15:10: yaml-language-server内に散見されるisKubernetesというフラグなんぞこれ... 特別扱いか...</pre>
<pre>hrsh7th 10日 00:17:02: workspace 対応は後付っぽいですからねｗ</pre>
<pre>h-michael 10日 00:21:26: いたるところにありますが実際はここにしか効いてこないですね
<https://github.com/redhat-developer/yaml-language-server/blob/70228ba25b33f4701e685ea6b37d0b665ad453fa/src/languageservice/parser/jsonParser07.ts#L250-L251></pre>
<pre>mattn 10日 09:58:16: vim が lsp を扱える様になって以来、ちょっと C# のコード見るのに Visual Studio 起動しなくなった。gd で目的の関数を即座に見れるの超ありがたい。</pre>
<pre>tsuyoshi_cho 10日 10:01:00: VSCodeからLSPが独立仕様になっての"IDEとして機能の分割"が現実的になったといえますねえ</pre>
<pre>mattn 10日 10:04:14: 電話しながら「ちょっと待ってて」って言いながら関数探せる。</pre>
<pre>hrsh7th 11日 11:32:59: これめっちゃ便利そうですね…
<https://github.com/tsuyoshicho/vim-efm-langserver-settings/blob/master/config/efm-langserver/config.yaml#L32|https://github.com/tsuyoshicho/vim-efm-langserver-settings/blob/master/config/efm-langserver/config.yaml#L32>

バッファをエクスプローラーで開く…</pre>
<pre>thinca 11日 11:34:31: Mac なのに Explorer とは… (Finder ではない?)</pre>
<pre>hrsh7th 11日 11:35:23: たしかに Win の用語になってますね。
思いつかないけど他にもいろいろできそうで面白い</pre>
<pre>tsuyoshi_cho 11日 11:36:02: 仮ですが、名前を統一したくてこうしてみまさた</pre>
<pre>thinca 11日 11:36:03: win と名前を統一したいとかなら Explorer は具体的なツール名なので Filer みたいな抽象的な名前にするといいのかも</pre>
<pre>tsuyoshi_cho 11日 11:38:59: あ、それ採用:+1::skin-tone-5:</pre>
<pre>tsuyoshi_cho 11日 11:39:39: ただ動作がまだだめなんですが…</pre>
<pre>thinca 11日 11:40:16: にしてもすでにエディタで開いているはずなのに Editor コマンドあるのすごいw</pre>
<pre>kuu 11日 11:41:10: VimからVim以外のエディタを立ち上げたいと思ったことないんですが、どんなユースケース想定してるんだろう</pre>
<pre>thinca 11日 11:45:00: デバッガーが使いたい！Visual Studio カモン！みたいなことはあるかもしれない (私はやったことないけど)</pre>
<pre>thinca 11日 11:45:28: てか LSP にデバッガー API って入る予定ないのかな。絶対必要だと思うのだけど (※何も調べずに発言しています)</pre>
<pre>eihigh 11日 11:48:32: <https://microsoft.github.io/debug-adapter-protocol/implementors/adapters/> ?</pre>
<pre>eihigh 11日 11:48:57: lspに入るかって言うと別軸で行く気がするんですけどどうなんです? （※何も調べずに発言しています）</pre>
<pre>kuu 11日 11:49:53: <https://github.com/emacs-lsp/dap-mode>
これはEmacsのものですが、外部から十分使えるっぽい（※何も調べずに発言しています ）</pre>
<pre>eihigh 11日 11:50:51: &gt; （※何も調べずに発言しています）
あまりにも最強無敵便利過ぎる免罪符だ</pre>
<pre>hrsh7th 11日 11:50:56: DAP と呼ばれてて、VSCode は対応しているらしいですね。
vim にも DAP 対応プラグインあるみたいですが試したことはないです。</pre>
<pre>kuu 11日 11:51:59: これのことか、名前だけは聞いたことあったけどそういうものだったのか <https://github.com/puremourning/vimspector></pre>
<pre>thinca 11日 11:53:01: LSP とは別?</pre>
<pre>heavenshell 11日 11:54:28: おー DAP 頑張ってる人いたんだ。一瞬 Vim からやってみようとして挫折したんだった。</pre>
<pre>hrsh7th 11日 12:04:49: デバッガ系は UI を作り込むのがつらそうですよね。好みもでちゃいますし。。。</pre>
<pre>tsuyoshi_cho 11日 12:08:45: あー、WindowsのExplorerが上手くいかんなー、と思ってましたが、ファイルパスが  `file:///C:/Users/name/README.md`  みたいになるからかー...</pre>
<pre>mattn 11日 13:03:00: os: mac で動きます？</pre>
<pre>mattn 11日 13:03:31: これ Go の GOOS なので darwin じゃないといかん気がする。</pre>
<pre>mattn 11日 13:05:42: あれ？ `${INPUT}` 、URI 形式になってますか？</pre>
<pre>tsuyoshi_cho 11日 13:16:48: えっと、macは確認できてないので、間違ってる可能性はあると思います。</pre>
<pre>mattn 11日 13:17:00: あ、code action 普通にバグってるな。</pre>
<pre>tsuyoshi_cho 11日 13:17:05: inputは <file://xn--echomsg-s83fqcb7azbu63a|file:// だってechomsgでました></pre>
<pre>tsuyoshi_cho 11日 13:17:10: おう</pre>
<pre>mattn 11日 13:21:33: 直しました。</pre>
<pre>tsuyoshi_cho 11日 13:22:41: えっと、貰うのはローカルのフルパスですか?</pre>
<pre>mattn 11日 13:22:46: あれ、でも select が動かないな</pre>
<pre>h-michael 11日 13:25:19: DAPはプロトコルがあまり好きになれない…</pre>
<pre>mattn 11日 13:26:31: あ、わかった。。</pre>
<pre>mattn 11日 13:33:33: select 動く様にしてリリースしました。</pre>
<pre>tsuyoshi_cho 11日 13:34:03: 了解です、フルパスで降ってくる前提で考えますね</pre>
<pre>mattn 11日 13:34:12: はい。</pre>
<pre>mattn 11日 13:35:11: あー(まだあるんかい)</pre>
<pre>tsuyoshi_cho 11日 13:35:21: www</pre>
<pre>mattn 11日 13:36:59: explorer、スラッシュだと動かないな。</pre>
<pre>tsuyoshi_cho 11日 13:37:30: あー...バックスラッシュが正規化されてるんですね</pre>
<pre>mattn 11日 13:38:08: UNIX 系ツールを扱うので efm の内部はスラッシュで統一してたんですよね。</pre>
<pre>mattn 11日 13:38:13: なんか考えないとな。</pre>
<pre>tsuyoshi_cho 11日 13:38:42: 界面(output/input)でWindowsは変換する、のがたぶん楽ではありそうです、が...</pre>
<pre>mattn 11日 13:39:45: `${INPUT}` をバックスラッシュ `${INPUT_SLASH}` をスラッシュとかにしたいけど既存の動作を変えないといけない。</pre>
<pre>mattn 11日 13:41:25: これはキメだな。</pre>
<pre>thinca 11日 13:47:12: `${INPUT//\\\\/\/}`</pre>
<pre>hrsh7th 11日 13:49:33: ${INPUT_WIN} ${INPUT}</pre>
<pre>tsuyoshi_cho 11日 13:50:24: `${INPUT_LOSE}`</pre>
<pre>mattn 11日 13:51:24: それか `${INPUT}` と `${FILENAME}` で分けるとか。</pre>
<pre>mattn 11日 13:51:55: hover もあるので共通的に `${INPUT}` 使ったけど `${FILENAME}` は正規化されてていいかな。</pre>
<pre>mattn 11日 13:52:09: hover の場合は `${INPUT}` が単語。</pre>
<pre>mattn 11日 13:52:14: よしそうしよう。</pre>
<pre>mattn 11日 13:54:53: たしed</pre>
<pre>tsuyoshi_cho 11日 13:56:51: 正規化ファイルパスは `${FILENAME}` を使う、ということで対応すればexplorerが動く、ということですね? ありがとうございます。</pre>
<pre>mattn 11日 13:57:41: はい。なんか `${INPUT}` の意味を逆に不明確にしてしまって若干申し訳なさ。</pre>
<pre>tsuyoshi_cho 11日 13:57:45: (文章がなんか変)</pre>
<pre>thinca 11日 13:58:05: ちなみに Mac での動作試験はテストを書けば GHA でできそう (と思ったけど Finder が開いたことをどうやってテストするのかと言う問題はありそうだ)</pre>
<pre>mattn 11日 13:58:29: !windows 使ってる人は `${INPUT}` のままでも問題なし。</pre>
<pre>tsuyoshi_cho 11日 13:59:08: む、どちらかというと hoverの時に特殊動作する機能付きのFILENAME=INPUT、という感じ?</pre>
<pre>mattn 11日 13:59:58: hover 時は `${INPUT}` しか見ない様にしました。</pre>
<pre>tsuyoshi_cho 11日 14:00:17: なるほど</pre>
<pre>tsuyoshi_cho 11日 14:01:15: とりあえず、仕組み上command(codeaction)だけfilenameにしておくといいかな...</pre>
<pre>mattn 11日 14:01:46: ですかね。バージョンを要求するのでお気をつけて。</pre>
<pre>mattn 11日 14:01:49: 同じ設定で自宅でウギャー、みたいな。</pre>
<pre>tsuyoshi_cho 11日 14:05:03: まあefmはすぐ更新するので、なんとか...</pre>
<pre>tsuyoshi_cho 11日 14:05:42: ちなみにFILENAMEであれINPUTであれ、ですがパスの空白のハンドリングってどうなっているのでしょう?
Windowsは `""` でくくってますが</pre>
<pre>mattn 11日 14:06:10: はい。その方がいいと思います。単なる文字列置換なのと、シェルを経由するので。</pre>
<pre>tsuyoshi_cho 11日 14:06:41: Mac で スペースありのフォルダで作業したときのほうがちょっと気になる(Linuxもなくはないけど)</pre>
<pre>mattn 11日 14:07:07: シェルに渡す時点でクオートは消えるので常に付けておいて問題ないと思います。</pre>
<pre>tsuyoshi_cho 11日 14:07:34: なるほど、全部に付けちゃおうかな...</pre>
<pre>tsuyoshi_cho 11日 14:42:32: うーん、やっぱちょっと変?
<https://github.com/tsuyoshicho/vim-efm-langserver-settings/blob/a4e681e5a95bfe392023c64702b73f2e1b90bd0b/config/efm-langserver/config.yaml>
```  - title: Filer
    os: windows
    command: explorer
    arguments:
      - '/select,"${FILENAME}"'```
で
```2020/03/11 14:32:45 jsonrpc2: &lt;-- result #2: textDocument/codeAction: [{"title":"Reload","command":"efm-langserver.:reload-config","arguments":["file:///C:/Users/username/tmp/test.svg"]},{"title":"Editor","command":"efm-langserver.notepad","arguments":["file:///C:/Users/username/tmp/test.svg"]},{"title":"Filer","command":"efm-langserver.explorer","arguments":["file:///C:/Users/username/tmp/test.svg"]},{"title":"Open","command":"efm-langserver.rundll32","arguments":["file:///C:/Users/username/tmp/test.svg"]}]```
というcodeActionレスポンスもらって ExplorerはNG(他は大丈夫)
• ファイルがFILENAMEでも `<file://のまま|file://` のまま>?
• commandの一意識別はこれで大丈夫? (macはopenでなんでもやる)</pre>
<pre>tsuyoshi_cho 11日 14:43:08: いちおう直ったあとのHEADをgo getしたんだけど...</pre>
<pre>mattn 11日 14:43:52: ファイル名は file:// 取ってるはずですね。 /select の場合はクオート付けちゃ駄目なのかも。</pre>
<pre>mattn 11日 14:44:38: このエラーの出方、explorer が non-zero exit code 返した時の奴です。</pre>
<pre>mattn 11日 14:44:55: rundll32 か。</pre>
<pre>tsuyoshi_cho 11日 14:45:10: 再度やってみますね</pre>
<pre>tsuyoshi_cho 11日 14:48:58: お、クォートしないと大丈夫でした。
お手数かけました...
そうかそうなるか</pre>
<pre>tsuyoshi_cho 11日 14:51:31: ただ、スペースありのパスにいると助けられなくなった...うーん</pre>
<pre>mattn 11日 14:52:24: 全体をクオートすると行けると思います。</pre>
<pre>mattn 11日 14:52:36: `"/select,C:\Program Files\..."`</pre>
<pre>tsuyoshi_cho 11日 14:54:20: ですね、いまやってみようと...確認中...</pre>
<pre>tsuyoshi_cho 11日 15:02:41: ```2020/03/11 15:00:42 jsonrpc2: --&gt; request #3: workspace/executeCommand: {"arguments":["file:///C:/Users/username/tmp/test%20folder/test.svg"],"command":"efm-langserver.explorer"}
2020/03/11 15:00:43 jsonrpc2: &lt;-- error #3: workspace/executeCommand: {"code":0,"message":"exit status 1","data":null}```
むー、%エンコーディング関係がもどせてない、とかありえますか?</pre>
<pre>tsuyoshi_cho 11日 15:02:53: なぜかブラウザで開かれてしまう...</pre>
<pre>mattn 11日 15:06:52: % は無くなってますね。</pre>
<pre>mattn 11日 15:08:03: ```  - title: Open
    command: cmd
    os: windows
    arguments:
      - /c
      - 'explorer /select,${FILENAME}'```</pre>
<pre>mattn 11日 15:08:07: これで行ける気がします。</pre>
<pre>tsuyoshi_cho 11日 15:12:18: おー、vimでのshell/shellargs的対応
やってみます</pre>
<pre>mattn 11日 15:19:34: Go の os/exec.Command を使ってコマンドを起動してますが、exec.Command は起動するプロセスの argv に正しく渡る様にエスケープしてるんですよね。これが逆に Windows アプリだと邪魔になる事がありますね。</pre>
<pre>mattn 11日 15:19:59: Windows はコマンド側が引数を解析するので難しい。</pre>
<pre>tsuyoshi_cho 11日 15:23:31: ありがとうございます。
ここの仕様だけは、すごいかなしみ..</pre>
<pre>tsuyoshi_cho 11日 15:27:13: :goodjob:</pre>
<pre>mattn 13日 10:14:12: <https://twitter.com/PrabirShrestha/status/1238222705352036353?s=20|https://twitter.com/PrabirShrestha/status/1238222705352036353?s=20></pre>
<pre>tsuyoshi_cho 13日 10:24:28: って、うえ、自分のもあわせて載っとるw</pre>
<pre>takets 13日 11:21:23: 最近coc使っていると、頻繁にintelephenseさんが黙って死んでしまう……</pre>
<pre>takets 13日 11:23:36: $this-&gt;を入力すると、lspが再起動する挙動が謎だ</pre>
<pre>hrsh7th 13日 11:43:39: _手元の環境がやっと落ち着いてきたので、workspace 進めます。。。遅くてすいません。。。_</pre>
<pre>thinca 13日 13:08:59: LSP だけのせいかどうかまだわからないのだけど、Ruby (with solargraph &amp; efm-langserver) を書いてると Vim がめちゃめちゃ重い…文字入れたりする度に0.n秒ずつくらい固まる…
午後は lsp#disable() して作業してみる</pre>
<pre>mattn 13日 13:11:50: 自動補完って使ってますか？</pre>
<pre>thinca 13日 13:13:27: asyncomplete みたいなのが入ってましたが一切設定をしてないです…</pre>
<pre>tyru 13日 13:47:42: 自分も python, js で新しいファイルを開くたびに重くなったりしたのでいい加減調査しないと（まずは vim-lsp の更新から）</pre>
<pre>kuu 13日 13:49:43: fsyncのせいだろうけどHDDにログ取ってたらものすごく重くなったということならあったな（関係あるかはわからないけど）</pre>
<pre>mattn 13日 14:00:39: キータイプ毎という事であれば asyncomplete が毎回リクエスト送ってしまってる疑惑はあります。</pre>
<pre>mattn 13日 14:00:54: ```let g:asyncomplete_popup_delay = 200```
とかそれ以上に設定するともしかすると少し軽減するかも。</pre>
<pre>heavenshell 13日 14:18:11: vim の lsp が遅くなったので使わなくなっちゃいました…。なお asyncomplete は使ってないです。</pre>
<pre>mattn 13日 14:23:40: どこが遅いか調べなきゃなー。</pre>
<pre>mattn 13日 14:25:03: このファイルでここ編集すると遅い、みたいなのが欲しい。。。</pre>
<pre>hrsh7th 13日 14:29:02: _なんか gopls さんのバージョンを上げたせいなのか、workspace folder に対応してなくても別プロジェクトでちゃんと補完が効いてしまう。。。_</pre>
<pre>heavenshell 13日 14:29:20: ちょっと週末また On にしてみます。</pre>
<pre>mattn 13日 14:30:42: すみません。ありがとうございます。</pre>
<pre>h-michael 13日 15:00:18: Vimにおいてworkspaceってどう対応していくべきかわからないんですよねー</pre>
<pre>hrsh7th 13日 15:42:02: 個人的には、単一 workspace 限定。
    単一 workspace の config をグローバルな関数で変更可能。
folders は workspace とか関係なく管理。

がいいのかなあと思っています。</pre>
<pre>thinca 13日 19:00:05: とりあえず lsp#dislabe() で完全に切った状態だと快適に編集できた</pre>
<pre>hrsh7th 13日 19:56:04: vim-lsp 状態にしてみたけど、別に普通に快適だなあ。。。</pre>
<pre>mattn 13日 20:02:14: lsp と補完エンジンってうまくタイミングなど考えないと lsp 側がリフレッシュしてくるので重くなりそう。</pre>
<pre>heavenshell 14日 14:38:37: 久々に vim-lsp と vim-lsp-settings 最新にしたら
`Not an editor command: ++once call lsp#register_server` が出たんですけど、また `++once` が動く Vim が必須になった感じですかね？</pre>
<pre>heavenshell 14日 14:41:43: や違う。</pre>
<pre>heavenshell 14日 14:41:53: 自分の環境がおかしかっただけでした :bow:</pre>
<pre>johejo 14日 23:46:20: LSPをwebsocketに載せてるのかな? <https://github.com/sourcegraph/sourcegraph-typescript></pre>
<pre>h-michael 15日 09:13:24: GDScriptのlspも確かwebsocketでした</pre>
<pre>tsuyoshi_cho 15日 12:01:06: `ご意見募集`
efm-langserverでwhitelistが `['*']`  的な時でも(vim-lspだけですが)blacklistで弾きたいファイルタイプはいろいろあると思います。
自分として、以下を初期設定する積りですが、「これは普通やっといたほうがいいだろう」というタイプがあればご意見をいたきたく
<https://github.com/tsuyoshicho/vim-efm-langserver-settings/issues/52#issuecomment-596924456></pre>
<pre>tsuyoshi_cho 15日 12:08:15: 現在再設計中...</pre>
<pre>kg8m 15日 13:56:31: `qf` も入れるとよさそう？</pre>
<pre>tsuyoshi_cho 15日 14:11:59: ありがとうございます。
buftypeがノーマルじゃないhelpやqfは発動してないっぽい</pre>
<pre>tsuyoshi_cho 15日 14:12:16: ただ、vim-lspだけでaleやcocがどうしてるかは未調査...</pre>
<pre>ycino 15日 15:13:15: `diff, man, fern, defx, capture`
`gina-status, gina-branch, gina-log, gina-reflog, gina-blame`</pre>
<pre>ycino 15日 15:14:01: やっといた方がいいというか、自分が弾いてる例ですが・・・</pre>
<pre>tsuyoshi_cho 15日 15:14:17: ginaのはたしかに必要ですねえ、diffやman...manにlspが作られる可能性は...あんまないか</pre>
<pre>tsuyoshi_cho 15日 15:14:24: ありがとうございます。</pre>
<pre>ycino 15日 15:15:32: txt弾いてよさそうな気がするけどどうなんだろう</pre>
<pre>tsuyoshi_cho 15日 15:15:58: いま、efm-langserverでtextのlinter動かしてますので、そこはちょっと...</pre>
<pre>thinca 15日 15:16:21: readonly / nomodifiable は判断の助けになりそう (バッファが作られた瞬間は設定されてないけど)</pre>
<pre>ycino 15日 15:16:31: あ、そうなんですね
textにlspやりようないかと感じたので、すみません</pre>
<pre>heavenshell 15日 15:16:43: git 関連ですかね。commit の時とか。</pre>
<pre>tsuyoshi_cho 15日 15:16:44: というかmanくらいだと書く人むけのlinterは使えるな...(ボケ)</pre>
<pre>tsuyoshi_cho 15日 15:17:23: lspがreadonlyとかチェックをもうちょっと厳しめにしているか、は気になるところ、でも今回こっちがどうこうはできる範囲ではないですね</pre>
<pre>thinca 15日 15:17:25: man は書く場合は別のフォーマットのはず…</pre>
<pre>tsuyoshi_cho 15日 15:17:38: あー、そうだ変換前提だった</pre>
<pre>ycino 15日 15:18:18: gitcommitとgina-commit両方を弾いてる部分がある、ginaはgina-commit返すんだっけ・・・？</pre>
<pre>ycino 15日 15:18:34: ginaでもcommitはgitcommitだったような気がするんだけど</pre>
<pre>tsuyoshi_cho 15日 15:19:25: <https://github.com/lambdalisue/gina.vim/blob/master/ftplugin/gina-commit.vim>
あるっぽいが、別に両方ハンドリングしている可能性がある?</pre>
<pre>ycino 15日 15:20:16: cmdwinはft=cmdwinでしたっけ</pre>
<pre>ycino 15日 15:20:29: gina、ちょっと確認してみます</pre>
<pre>kuu 15日 15:20:30: vimですね</pre>
<pre>ycino 15日 15:20:46: vimか、そこはftで弾けないですね</pre>
<pre>kuu 15日 15:21:15: `!empty(getcmdwintype())` で弾いた</pre>
<pre>ycino 15日 15:21:18: cmdwinからpopupwin、動くのかな</pre>
<pre>ycino 15日 15:22:53: `:Gina commit` からだと `gina-commit` ですね
gitcommitと両方入れた方がよさそう</pre>
<pre>kuu 15日 15:23:25: 前git関連のプラグインにPR送った時はg*commitでやった（いいのか）</pre>
<pre>ycino 15日 15:23:43: 予想外の弾きそうではあるけどそれでいいかも？</pre>
<pre>ycino 15日 15:24:08: ひとまず `gina-*` はやっておいてもよさそう</pre>
<pre>thinca 15日 15:24:46: プラグインごとに対応するの正直キリがないと言う気持ちはある</pre>
<pre>ycino 15日 15:25:28: どこまでやるかではありますよね（Issueに結構プラグインのが入ってたから色々書いてしまった）</pre>
<pre>thinca 15日 15:25:29: さっき言った readonly とかその辺りで何かイイカンジにできないだろうか (雑)</pre>
<pre>kuu 15日 15:25:39: 今回のケースだとgitcommitだけ弾いて後はユーザーが指定してねがいい感じ</pre>
<pre>thinca 15日 15:26:30: gina であっても commit はさすがに readonly じゃなさそうだな…</pre>
<pre>kuu 15日 15:26:54: むしろreadonlyだと逆に困る</pre>
<pre>tsuyoshi_cho 15日 15:27:38: lspの機能にのっかるので、そうしようもないのです....
ただ、ある程度はデフォルトちゃんとそろえるのが、このプラグインとしては労力のかけどころなのでがんばります</pre>
<pre>thinca 15日 15:28:07: 独自ではないのか。単に設定を提供するだけだからか</pre>
<pre>thinca 15日 15:28:17: vim-lsp 側に PR 出せば解決</pre>
<pre>thinca 15日 15:28:48: 後はバッファ名とかか…</pre>
<pre>ycino 15日 15:30:24: qfreplaceは多分editableかつ弾きたい対象ですかね？</pre>
<pre>tsuyoshi_cho 15日 15:30:39: あー、たしかにqfreplaceもそうですねえ</pre>
<pre>thinca 15日 15:32:49: 作り直さないと…</pre>
<pre>thinca 15日 15:34:49: 弾きたいバッファかどうかをもうちょい柔軟に指定できるように vim-lsp 側を改善するのが先な気がする</pre>
<pre>tyru 15日 15:35:11: buftype=acwrite 以外で buftype 設定されてたら弾くとかでもいい気がする</pre>
<pre>thinca 15日 15:35:33: 式で判定できるように、とか。場合によっては遅延 (timer で) してから判定までできないとキビしいかもしれない</pre>
<pre>thinca 15日 15:35:43: qfreplace は acwrite</pre>
<pre>kuu 15日 15:35:51: timer絡むとつらい</pre>
<pre>thinca 15日 15:36:34: バッファが生成された瞬間って各種オプションがまだ設定されていなかったりする。たいてい、バッファを開いてからオプションをあれこれ設定するので</pre>
<pre>tsuyoshi_cho 15日 15:36:37: これでもvim-lspは素直でしっかり設定できるんですよね
全タイプとして '*' 、それのblacklistを設定できる
aleやcocは特定のタイプに紐付けが必要で anyとか any with excludeができない...</pre>
<pre>tyru 15日 15:36:53: buftype 見た感じ acwrite はなんか vim-lsp 走ってほしそうなケースもありそうな…
buftype が空かどうかで判断しちゃっていいのかな\</pre>
<pre>tsuyoshi_cho 15日 15:37:07: Filetypeイベントで大体は平気なんですけどね...</pre>
<pre>thinca 15日 15:37:11: そもそも filetype だけで判断するのに無理がある…</pre>
<pre>kuu 15日 15:38:06: acwriteってnetrwとかmetarwとか走った時になるやつか、だとしたらありそう</pre>
<pre>thinca 15日 15:38:12: いやーあれか。個人向けの設定ならそれでもまあだいたいなんとかなるけど、汎用的な設定を作ろうとしているのがしんどいのかなー</pre>
<pre>ycino 15日 15:39:28: 個人だと10個くらい調べて弾けばどうにかなりますしねぇ</pre>
<pre>tsuyoshi_cho 15日 15:45:15: まー、できるだけ、なので辛くなったら止めますw</pre>
<pre>tsuyoshi_cho 15日 15:45:43: あと、設定は可能なので、自分で追加(ただし効くのはvim-lsp)で</pre>
<pre>heavenshell 15日 15:49:48: PRs are welcome というスタンスで良さそうですねw</pre>
<pre>tsuyoshi_cho 15日 17:40:37: <@U03C6TEAZ>
これは対応は不要かもしれませんが...
efm-langserver で formatter の stdin 対応がされましたが、stdin false(ファイルが更新される)にもかかわらず、結果を(stdinから?)適用しようとしてバッファが空になります(空出力に置き換えになる)
その後、ファイルの変更を検知してフォーマット結果を読める、という動きになっているように見えます。
できれば空での上書きがないようにしたほうがよいのではないか、と思います。</pre>
<pre>lighttiger2505 15日 17:45:47: やっとこsqlsのサブクエリ補完が動きはじめました。
<https://twitter.com/LightTiger2505/status/1239110193255833601></pre>
<pre>mattn 15日 17:51:04: stdin false の時は `${INPUT}` がないと formatter はどのファイルか分からないでしょうから空になると思います。</pre>
<pre>tsuyoshi_cho 15日 17:55:36: ええ、なのでformatの応答をうまく捨てれたらなあ、と思ったのですが...むずかしそうですね</pre>
<pre>tsuyoshi_cho 15日 17:56:02: (いろいろやってるけど、jqでlint(formatではなく)ができない...</pre>
<pre>mattn 15日 21:01:58: ignore-exit-code を format に入れるといい感じですか？</pre>
<pre>tsuyoshi_cho 15日 21:16:43: lintなのですでにあるのですが...efmのREADMEにあるjq での json lint、結果がなんか拾えてなくて</pre>
<pre>yaegassy 15日 22:45:23: jq って、そもそも linter として使えるんですかね？ ale だと linter は jsonlint しかなくて formatter としては jq は対応してるようでしたが</pre>
<pre>lighttiger2505 15日 22:48:22: パースできないときのエラーを吐いているのでそのポジションを取ればできなくはない気がしますが。</pre>
<pre>yaegassy 15日 22:50:22: こんな感じのパースエラーを元にってことなのですかね。なるほど
```$ cat a.json | jq -
jq: error: syntax error, unexpected $end (Unix shell quoting issues?) at &lt;top-level&gt;, line 1:
-
jq: 1 compile error```</pre>
<pre>tsuyoshi_cho 15日 22:50:59: ええ、efmのREADMEにもあるし、やれるかなーとやってますが、なんかとれない...stderrに吐いてるのかな?</pre>
<pre>tsuyoshi_cho 15日 22:51:42: やっぱそうだ、stderrに吐いてる...からリダイレクトすると取れるか?</pre>
<pre>yaegassy 15日 22:55:38: `-` が余計かな...
```$ cat a.json | jq
parse error: Unfinished string at EOF at line 4, column 0```</pre>
<pre>yaegassy 15日 22:57:29: stderr ですね</pre>
<pre>tsuyoshi_cho 15日 22:57:51: いまちょっと小細工して確認してます...</pre>
<pre>tsuyoshi_cho 15日 23:13:03: むう、シェルにわたすとはいえ、
``` lint-command: 'jq 2&gt;&amp;1'```
では通らんか...</pre>
<pre>mattn 15日 23:51:29: 異常の場合には non-zero が返って format 自体が失敗するはずなんですけどね。</pre>
<pre>mattn 15日 23:52:27: なので空にはならないイメージです。</pre>
<pre>tsuyoshi_cho 15日 23:54:34: いえ、formatじゃなくlintなんです...
formatはOK</pre>
<pre>mattn 15日 23:55:13: lint は ignore-exit-code を false にすれば同じ動きになると思っています。</pre>
<pre>mattn 15日 23:56:01: そもそも lint はバッファを更新しないので。</pre>
<pre>mattn 15日 23:56:23: 空になったとすれば efm 以外の要因な気がします。</pre>
<pre>tsuyoshi_cho 15日 23:57:15: あ、すいません、format時の空になる件ですね?</pre>
<pre>mattn 15日 23:57:54: 別の話でしたか？</pre>
<pre>tsuyoshi_cho 15日 23:58:09: はい、ちょっと別の話があります(混乱させてすみません)</pre>
<pre>tsuyoshi_cho 15日 23:58:45: 1. ある種のformatterは ファイルを更新するが、そのときバッファが一度空になる現象がある
2. jq で うまくlintできないなあ(サンプルだと)</pre>
<pre>mattn 15日 23:59:23: formatter の件は、formatter に直接ファイルを更新させてはだめです。</pre>
<pre>tsuyoshi_cho 15日 23:59:37: なんですよねー</pre>
<pre>tsuyoshi_cho 15日 23:59:50: markdownlintのfixはあきらめたほうがいいかな...</pre>
<pre>mattn 16日 00:00:24: テンポラリファイルを作ってそのファイルで format、結果のファイルを cat すればいいのかなと。</pre>
<pre>mattn 16日 00:00:56: それ用の hack を efm に入れれるかもしれませんが。</pre>
<pre>tsuyoshi_cho 16日 00:01:34: 設定側が実現したくてやるなら、ラップするシェルスクリプトでも作らんとですね...</pre>
<pre>tsuyoshi_cho 16日 00:02:25: 要求レベルは低いので、課題の1つ、くらいの認識でもっていただけるとうれしいかな、くらいです</pre>
<pre>mattn 16日 00:18:38: なるほど</pre>
<pre>kyoh86 16日 02:33:28: fzfのpopup使ってると、たまにvim-lspっぽいところでエラーになってpopupが死ぬなぁ</pre>
<pre>kyoh86 16日 02:35:05: ```BufWipeout Autocommands for "*" の処理中にエラーが検出されました:
E994: ポップアップウィンドウでは許されません```
今の所入れてるプラグインや設定でBufWipeout使ってるのvim-lspだけなのでおよそ間違いなさそう。

<https://github.com/prabirshrestha/vim-lsp/blob/2de8f4d479229eedcb9bf41a878b94fb7e2662ed/autoload/lsp.vim#L200></pre>
<pre>kyoh86 16日 02:35:32: こういうとき日本語化してると気軽にIssue起こせなくて面倒くさいなあ</pre>
<pre>kyoh86 16日 02:39:11: `:language messages en_US.UTF-8` しておいて再現したらまたIssue切ろう…</pre>
<pre>tsuyoshi_cho 16日 04:50:10: なるほど</pre>
<pre>kyoh86 16日 06:37:24: ```Error detected while processing BufWipeout Autocommands for "*":
E994: Not allowed in a popup window```
出よった</pre>
<pre>kyoh86 16日 06:49:58: <https://github.com/prabirshrestha/vim-lsp/issues/754></pre>
<pre>kyoh86 16日 06:50:00: 切った</pre>
<pre>hrsh7th 16日 11:27:40: _週末に作業時間がとれるかどうかがかなり運ゲーになってしまっている。。。_</pre>
<pre>hrsh7th 16日 11:28:24: workspace 対応を PR 出しました。
vim-lsp のばあい、`workspace_config` の管理が現状 per server になっているので、そこを破壊せずに対応した感じにしました。</pre>
<pre>hrsh7th 16日 11:28:59: 個人的には workspace_config はグローバルに一つというのが正しい認識かなとは思いますが、これはこれで自由度高くなっていいかもと思っています。</pre>
<pre>hrsh7th 16日 11:30:35: 対応後のブランチではどんなに複数の Golang のプロジェクトのファイルをまたがって編集操作をしたとしてもちゃんと補完候補が返ってくるが、
対応前のブランチ（master）では、時折まったく補完候補が返却されないことがあるので正しく動いていると思います。</pre>
<pre>tsuyoshi_cho 16日 15:16:54: notice:
<https://github.com/tsuyoshicho/vim-efm-langserver-settings/issues/61>
vim-efm-langserver-settings の設定を見て、「あ、自分が出した意見が入ってる」と思うものがあったら:raising_hand:していただけると幸いです。
Special Thanks として掲載しようかなと
どなたにご協力いただいたか、記憶もログも定かではなくorz</pre>
<pre> 16日 22:42:35: <@U03C6TEAZ>
vim-lspをつかっているのですが、あるプロジェクト内では定義ジャンプができない場合があります。
そのプロジェクト内で定義したパッケージの関数にジャンプはできない状態です。

ログを出してみたものの、原因わからず状態です。
ログを見て頂けますか？</pre>
<pre>mattn 16日 22:44:58: 今は　xxx にいると思えばいいですか？そこに go.mod と go.sum がある状態ですか？</pre>
<pre>ゴリラ 16日 22:47:19: xxx/api にいます
そこにgo.mod と go.sum があります</pre>
<pre>mattn 16日 23:27:27: 最後のジャンプは飛べてそうです。</pre>
<pre>ゴリラ 16日 23:31:26: 確かに、最後のレスポンスは問題なさそうすけど、やっぱ飛べないスネ。。。</pre>
<pre>ゴリラ 16日 23:32:23: 前（1年くらい前）は飛べた記憶がある。。。</pre>
<pre>ゴリラ 16日 23:35:03: ちなみに、 go.mod と go.sum は一度削除して作り直しました</pre>
<pre>mattn 16日 23:39:08: 同じリポジトリをどこかに置いてもらえると確認できるかも。</pre>
<pre>ゴリラ 16日 23:40:24: privateなやつですが、ちょっと招待しますね</pre>
<pre>ゴリラ 16日 23:41:34: <@U03C6TEAZ> 招待しました</pre>
<pre>mattn 17日 12:59:25: <https://twitter.com/presuku/status/1238435776343330816></pre>
<pre>mattn 17日 12:59:32: なんだろう...</pre>
<pre>hrsh7th 17日 13:10:25: BufReadPost の段階で FileType が決まっていないとかなんですかね。。。謎ですね。。。</pre>
<pre>tsuyoshi_cho 17日 13:14:03: ただ、statuslineにserverの状態を出していると、whitelist [*] blacklist [hoge] でhogeで起動しかけつつ、後で状態としてサーバなしになったりとか、たまーに不思議状態っぽいものを見ることはあるので、なんか隙間があるのかな...?</pre>
<pre>thinca 17日 13:14:37: filetype は BufReadPost の過程で設定されるので BufReadPost で filetype 未決定は当然ある</pre>
<pre>presuku 17日 15:37:35: `vim test.c`と、vim起動後の`:e test.c` のそれぞれのログに、前者は`lsp#register_server` があって、後者にはないので、後者の場合は 空のバッファ（つまりftは空）を開いたあと vim-lsp の方で VimEnter で `lsp#enable`しているからかと思った次第です。vim-lsp-settings は FileType イベントで`lsp#register_server` しているっぽい(?)ので、先に空のバッファを開いてしまうとダメなのかなと。</pre>
<pre>thinca 17日 15:38:53: lsp#enable した後だと register されない? ってのも不思議ですね…</pre>
<pre>presuku 17日 15:56:46: あと、これを試してるときは pack/minpac/opt に入れてて .vimrc で packadd vim-lsp　などしてたんですけどそれですかね…
もともとは、特定のFileTypeの時にpackaddしてたのですがvim-lsp-settings導入時にそれがうまくいかなくなり、特定の拡張子の時の BufNewFile, BufRead でpaするようになり、上記の問題があったので最終的に↓な感じになりました。
```let g:lsp_auto_enable = 0
fu! s:on_ftdetect_packadd_lsp() abort
  cal s:wrap_packadd(['vim-lsp', 'vim-lsp-settings', 'vim-lsp-snippets', 'vim-lsp-neosnippet'])
  au BufEnter * ++once cal lsp#enable()
endf
aug ft_pack_settings
  au!
  au BufNewFile,BufRead
        \ *.rs,*.c,*.cpp,*.h
        \ ++once
        \ cal &lt;SID&gt;on_ftdetect_packadd_lsp()
aug END```</pre>
<pre>presuku 17日 16:03:38: しかし、これも将来的には`:LspPackaddAndStart`的なコマンドでガッツリ編集したくなったら lsp を有効になるようにしたいなぁと思ってるところです (拡張子ないしFileType毎の有効/無効じゃなくて)</pre>
<pre>tsuyoshi_cho 17日 22:47:17: <https://vim-jp.slack.com/archives/CLKR04BEF/p1584452703466000>
とのこと</pre>
<pre>vikke 17日 22:47:24: <#CLKR04BEF|plugins> から流れて来ました。
vim-lsp-settingsで質問です。 phpで、LspInstallServerは通ったんですけど、LspUninstallServerすると Invalid server name 言われてuninstall出来ないんですけど、誰か情報持ってませんか?</pre>
<pre>vikke 17日 22:47:30: かぶった。</pre>
<pre>tsuyoshi_cho 17日 22:47:36: ww、ごめんw</pre>
<pre>vikke 17日 22:47:47: いえいえ。ありがとうございます。</pre>
<pre>tsuyoshi_cho 17日 22:48:42: 作者のmattnさんとかなら、0時前くらいには、なにかしら応答がある、かな?</pre>
<pre>vikke 17日 22:49:42: その頃にはドリーミンなんで明日の朝対応かなー。</pre>
<pre>tsuyoshi_cho 17日 22:53:36: ただ、コードを見る分には愚直にrm rfするだけなんですよね...
ちなみに現在そのサーバの状態を直に確認できますか? 存在しているのかとか</pre>
<pre>heavenshell 17日 22:54:29: servers の置き場が変わってその影響とか？(完全にエスパー</pre>
<pre>tsuyoshi_cho 17日 22:55:07: あー、デフォルト値が変ったときのを
1. インストール
2. プラグイン更新
3. アンインストール(で失敗)
とか?</pre>
<pre>vikke 17日 22:55:22: サーバーの状態ってどうやって確認出来ます?</pre>
<pre>thinca 17日 22:55:35: `:LspStatus`</pre>
<pre>vikke 17日 22:55:51: intelephense: running ですね。</pre>
<pre>vikke 17日 22:56:50: インストールはこんな感じでやってます。deinです。
```    call dein#add('prabirshrestha/async.vim')
    call dein#add('prabirshrestha/vim-lsp')
    call dein#add('mattn/vim-lsp-settings', {'merged': 0})
    " call 'Shougo/deoplete.nvim'
    call dein#add('lighttiger2505/deoplete-vim-lsp')```
</pre>
<pre>thinca 17日 22:57:17: アンインストールのために実際に実行したのは `:LspUninstallServer intelephense` でしょうか?</pre>
<pre>vikke 17日 22:57:37: ftがphpの状態で、 :LspUninstallServer のみです。</pre>
<pre>vikke 17日 22:57:45: 引数必要ですか?</pre>
<pre>thinca 17日 22:57:52: 必要です</pre>
<pre>yaegassy 17日 22:58:30: それっぽそうですね</pre>
<pre>vikke 17日 22:58:31: 出来た。。。。
helpしたらヘルプ無かったので。。。</pre>
<pre>thinca 17日 22:58:40: さすがに誰かそろそろドキュメント書いた方がよさそう…</pre>
<pre>vikke 17日 22:58:42: あざます。</pre>
<pre>heavenshell 17日 22:58:50: エラーならないのか。</pre>
<pre>tsuyoshi_cho 17日 22:58:53: あらら...なるほど</pre>
<pre>thinca 17日 22:58:54: ボランティア絶賛募集中 (OSS)</pre>
<pre>vikke 17日 23:00:30: ちなみについでで聞くんですが、intelephense(php)で書く時って、phpはinclude_pathって奴でclassのrootを複数指定出来ますが、これって、どうやって出来ます?
そんなクラス無いと言われてしまうんです(まー見えてないんであたりまえですが)</pre>
<pre>h-michael 17日 23:04:45: それはあるとすればlanguage serverに渡す設定なのでserver側のreadmeか何か見たほうがいいですね</pre>
<pre>tsuyoshi_cho 17日 23:06:17: workspace_configにその手の情報がセットできれば...という感じですね...(あるかは不明)</pre>
<pre>yaegassy 17日 23:07:11: PHPちょっとは触ってますが、さすがに include_path はもう長らく使ってない...</pre>
<pre>yaegassy 17日 23:07:31: ```intelephense.environment.includePaths```</pre>
<pre>yaegassy 17日 23:08:02: こんなのがあるのでこれかなー</pre>
<pre>vikke 17日 23:08:46: ほほー。</pre>
<pre>vikke 17日 23:10:18: 複数のrootってどうしてます? あるいはvendor配下とか。 <@U7TMPGWJ0></pre>
<pre>yaegassy 17日 23:11:48: 複数のrootっていうのがちょっとわからないのですが。composerのautoloadしかもう使ってないですね</pre>
<pre>vikke 17日 23:12:39: intelephenseがcomposerのautoloadに対応している感じですか?</pre>
<pre>vikke 17日 23:12:51: もういっかいintelephense入れなおした。</pre>
<pre>vikke 17日 23:14:42: なんか超絶初心者ですいません。</pre>
<pre>vikke 17日 23:15:39: intelephenseがautoloadに対応してくれれば(というかしていそう)、うれしい。</pre>
<pre>yaegassy 17日 23:16:36: 勿論大丈夫ですよ</pre>
<pre>mattn 17日 23:17:46: help を書いた方がいい、だけ読んだ。</pre>
<pre>vikke 17日 23:17:55: ネ申キタ━━━( ´∀`)・ω・) ゜Д゜)・∀・)￣ー￣)´_ゝ`)━━━!!!!</pre>
<pre>vikke 17日 23:18:32: src読むの前提のみなさんなんですね。</pre>
<pre>tsuyoshi_cho 17日 23:20:05: 慣れてる側がそうなだけで、一般的ではないはずw</pre>
<pre>mattn 17日 23:20:09: vim-lsp-settings はヘルプ無しで使えるという目標を掲げつつヘルプを書くのをサボるプロジェクトです。</pre>
<pre>vikke 17日 23:20:26: 高尚だ。</pre>
<pre>thinca 17日 23:20:29: 使えてないじゃない</pre>
<pre>vikke 17日 23:21:00: だれか、intelephenseにautoload渡す方法教えておくれよ。</pre>
<pre>mattn 17日 23:21:41: intelephense 詳しくないです。。。</pre>
<pre>vikke 17日 23:24:23: む。じゃ、時間ある時に調べてみよう。(時間があるとは言っていない)</pre>
<pre>vikke 17日 23:24:54: みんなphp書いている人、どうしているんだろう。laravelとか書いていると、補完もまともに効かないと思うんだけどなー。</pre>
<pre>yaegassy 17日 23:25:49: あれ？Laravelなんですか？</pre>
<pre>yaegassy 17日 23:25:52: include_path ってお話されてたので。10年くらい前のPHPのソースをいじってるのかと思ってました</pre>
<pre>heavenshell 17日 23:26:51: intelephense 使ってないし完全に想像だけど、vim-lsp の workspace の設定のところに
```"intelephense.environment.includePaths": {
    	"type": "array",
        "items": {
        	"type": "string"
        },
        "description": "The include paths (as individual path items) as defined in the include_path ini setting. Used for resolving script inclusion.",
        "scope": "window"
    },```
みたいに書くのかな？</pre>
<pre>vikke 17日 23:27:48: あー、すいません。include_pathはウソです。ウソつきです。composerのautoloadです。</pre>
<pre>vikke 17日 23:28:14: サンプルありがとうございます。これはこれで参考になる。</pre>
<pre>mattn 17日 23:29:12: vim-lsp でやるなら `.` を含んだキーはネストしないかもいけないかも。</pre>
<pre>tsuyoshi_cho 17日 23:30:10: 多段dictの初期化の良い方法はないものか...</pre>
<pre>yaegassy 17日 23:30:31: Laravelは黒魔術(メタクラス的なマジックメソッド)を沢山使ってるので laravel-ide-helper というジェネレーター的なのを入れて。それを使って実在しないクラスやメソッドを吐き出す儀式が必要です <https://github.com/barryvdh/laravel-ide-helper></pre>
<pre>heavenshell 17日 23:30:50: ```"intelephense": {
  "environment": {
    "includePaths": {
      "type": "array",
      "items": {},
    }
  }
}```
こうか。</pre>
<pre>mattn 17日 23:30:53: <https://github.com/mattn/vim-lsp-settings/blob/8a50c71c44a9894b33a81344ab6a76fb07a38ce2/autoload/lsp_settings/utils.vim#L34></pre>
<pre>yaegassy 17日 23:30:57: これはJetBrainsのPHPStormでも同様に必要な儀式</pre>
<pre>heavenshell 17日 23:31:09: “intelephense.environment.includePaths” ってキー名じゃないんですね。</pre>
<pre>vikke 17日 23:31:24: railsと同じ黒魔術。。。</pre>
<pre>mattn 17日 23:31:31: `.` を含んだ辞書は↑の dotmerge で展開できます。</pre>
<pre>tsuyoshi_cho 17日 23:31:31: 俗にvim-lsp的読み替えというやつ...</pre>
<pre>mattn 17日 23:32:08: vim-lsp-settings の場合、Vim script で書くより `:LspSettingsEditLocal` で JSON 弄った方が楽かも。</pre>
<pre>heavenshell 17日 23:32:19: ```lsp_settings#utils#dotmerge("intelephense.environment.includePaths")```</pre>
<pre>heavenshell 17日 23:32:22: こうです？</pre>
<pre>mattn 17日 23:32:42: あ、いえ heavenshell さんが書いた dict のほう。</pre>
<pre>heavenshell 17日 23:32:50: あ、なるほど。</pre>
<pre>vikke 17日 23:37:23: そろそろ落ちます。あざました。明日、補完出来るように色々見てみます。</pre>
<pre>mattn 18日 00:43:47: <https://github.com/sveltejs/language-tools></pre>
<pre>mattn 18日 00:44:00: svelte はじめて聞いた。</pre>
<pre>mattn 18日 00:44:53: めっちゃ遊んだ事あった模様。 <https://twitter.com/search?q=from%3Amattn_jp%20svelte&amp;src=typed_query></pre>
<pre>mattn 18日 00:45:08: お爺ちゃん、それ前遊んだでしょ。</pre>
<pre>mattn 18日 00:46:12: 思い出した...</pre>
<pre>heavenshell 18日 00:52:30: ワロタw</pre>
<pre>heavenshell 18日 00:59:13: svelete で思い出したけど lit-html は ts の plugin かー。うまくいけば ts-graphql-plugin 見たく vim-lsp と連携できるのかな…。
<https://github.com/microsoft/typescript-lit-html-plugin></pre>
<pre>tomoya 18日 00:59:54: あー svelte、mattn さんの tweet で知ったわー</pre>
<pre>mattn 18日 01:00:22: 今モダンなテンプレートライブラリって何になるんですかね。</pre>
<pre>heavenshell 18日 01:00:44: node.js 界隈ですか？</pre>
<pre>mattn 18日 01:01:00: はい。</pre>
<pre>mattn 18日 01:01:19: react 的にやるならいらない感じ？</pre>
<pre>mattn 18日 01:02:01: server side ならあるか。</pre>
<pre>heavenshell 18日 01:02:04: 最近まさにそれ調べてたんですが、<https://github.com/marko-js> とかなんですかね。</pre>
<pre>mattn 18日 01:02:38: <https://markojs.com/></pre>
<pre>heavenshell 18日 01:03:22: ejs, pug あたりは鉄板として。Jinja2 っぽいのなら Mozilla 製の nunjucks とか。</pre>
<pre>mattn 18日 01:03:38: ほえー、slim template ぽい。</pre>
<pre>heavenshell 18日 01:03:57: 私は HTML のテンプレートエンジンがほしいわけじゃなかったので、結局 template literal で頑張りましたけども…。</pre>
<pre>mattn 18日 01:04:15: ```<!doctype html>
html
    head
        title -- Hello Marko
    body
        h1 -- My favorite colors
        ul.colors
            for|color| of=input.colors
                li -- ${color}```</pre>
<pre>mattn 18日 01:04:25: slim やん</pre>
<pre>heavenshell 18日 01:04:30: pug はそうですね。</pre>
<pre>mattn 18日 01:05:06: 速いは正義</pre>
<pre>mattn 18日 01:07:47: この辺いろいろありすぎてすぐ廃れそうな気がして使うの怖い。</pre>
<pre>mattn 18日 01:08:39: riotjs で書いたの書き換えるべきなんかなぁと最近思ったりしています。</pre>
<pre>heavenshell 18日 01:08:58: そうですねー。</pre>
<pre>heavenshell 18日 01:10:14: riotjs はすぐに廃れることはないんじゃないですかねー。</pre>
<pre>heavenshell 18日 01:11:24: 久々に riotjs のサイト見たらいつの間にか 4 になってたw</pre>
<pre>mattn 18日 01:11:29: あまり評判がよろしくないw</pre>
<pre>mattn 18日 01:12:48: <https://twitter.com/mizchi/status/1239475100740497410></pre>
<pre>heavenshell 18日 01:13:18: 私も前職で全力で止めましたw プロダクションでは辛いってw</pre>
<pre>heavenshell 18日 01:16:34: 最近は落ち着いてきたとはいえ、流行り廃り激しいですからねぇ。</pre>
<pre>mattn 18日 01:18:01: 無駄に覚えないといけない物が多いの辛くなるので避けたいんですけどね。</pre>
<pre>heavenshell 18日 01:18:52: まぁそういう意味では slim ライクな pug とかは良いかもですね。細かいところがどう違うかは slim を知らないのでなんともですが。</pre>
<pre>heavenshell 18日 01:20:27: pug で静的 html なサイトを 3 年くらいメンテしてましたが、特に問題も起きなかったです。</pre>
<pre>mattn 18日 01:22:23: 直感的ですしシンプルなの作るには楽なんですが、このスタイルで書けるからどうやねん、みたいな感覚に襲われる事もあります。</pre>
<pre>mattn 18日 01:23:33: ruby みたく one-liner で書けると気持ちよさがあるんですけどね。</pre>
<pre>mattn 18日 01:24:32: というのを、go で書いた slim テンプレートエンジン(と VM) を書いた後に気付きました。 <https://github.com/mattn/go-slim/></pre>
<pre>heavenshell 18日 01:24:43: w</pre>
<pre>mattn 18日 01:25:52: ただ go-slim はテンプレートに chan を渡すという実験としては面白かった。</pre>
<pre>tomoya 18日 01:26:25: 個人的にテンプレートは学者コスト（スイッチコストかも）があれなのでどうも苦手ですね
JSXはXMLだと思って書いてるからなんとなってます。</pre>
<pre>mattn 18日 01:27:05: なんか知らんけど mustache は良く使ってます。</pre>
<pre>heavenshell 18日 01:27:29: あーそういう意味では私はもともと PHPer なのでタグ書くの苦じゃないんですよね。なので JSX もすんなり受け入れられました。</pre>
<pre>mattn 18日 01:27:36: 他の言語にコピれるからかな &gt; mustache</pre>
<pre>heavenshell 18日 01:28:10: handlebars とかも一定の人気あるみたいですね。</pre>
<pre>heavenshell 18日 01:28:46: ghost ってブログエンジンのテンプレートがこれでした。</pre>
<pre>mattn 18日 01:30:10: <https://ghost.org/></pre>
<pre>mattn 18日 01:30:16: わりかしお高い</pre>
<pre>mattn 18日 01:31:52: 僕みたいにフロントに疎い人は、廃れた時の道連れになる人が多いと安心するのかもしれないw</pre>
<pre>tomoya 18日 01:32:07: 世の中色々あるなぁ</pre>
<pre>mattn 18日 01:32:41: まぁ実際、道連れが多いってことは完全には廃れない訳で。</pre>
<pre>mattn 18日 01:33:04: mustache なんかそれだと思う。</pre>
<pre>tomoya 18日 01:33:16: 確かに</pre>
<pre>tomoya 18日 01:33:40: mustache は長生きしそう</pre>
<pre>mattn 18日 01:33:54: こんだけ色んな言語に porting されてたら絶対廃れない。 <https://mustache.github.io/></pre>
<pre>tomoya 18日 01:36:20: やっぱり男は黙ってHTMLですね（ここ5年くらいまともに書いてない</pre>
<pre>heavenshell 18日 01:36:25: なんせ Vim script 版もあるくらいですしねw
<https://github.com/tobyS/vmustache></pre>
<pre>mattn 18日 01:36:58: すごい</pre>
<pre>mattn 18日 01:37:46: あぁ、やっぱりね。みたいな顔してる。 <https://github.com/tobyS/vmustache/blob/d39f77bafef57ba7af304c74b3cfc91a83fd86e0/autoload/vmustache.vim#L6-L12></pre>
<pre>heavenshell 18日 01:38:12: そうですねw 最初見たときそう思いましたw</pre>
<pre>mattn 18日 01:39:20: これやると `{{ "fo{" }}` みたいな事できないんですよね。(やらないけど)</pre>
<pre>mattn 18日 01:39:29: 逆か。</pre>
<pre>mattn 18日 01:39:39: `{{ "foo}}" }}`</pre>
<pre>heavenshell 18日 01:39:58: <https://github.com/tobyS/vmustache/blob/d39f77bafef57ba7af304c74b3cfc91a83fd86e0/autoload/vmustache.vim#L70>
そうですねw</pre>
<pre>tomoya 18日 01:40:32: そういえば、Go のテンプレートは mustache 由来なんですかね？</pre>
<pre>mattn 18日 01:40:56: そういう訳ではないですね。Rob Pike が直感のみで書いてました。</pre>
<pre>johejo 18日 01:41:26: 直感のみ</pre>
<pre>mattn 18日 01:41:43: 最初から `{{.}}` は入ってましたね。</pre>
<pre>tomoya 18日 01:42:00: Pike先生の直感だったのか</pre>
<pre>heavenshell 18日 01:42:36: `{{ }}` の最初の出自ってどこなんだろう。Django template あたりなのかな…。</pre>
<pre>mattn 18日 01:42:56: どんどん出来上がるさまを見てたので「はぇぇなw」って感動しましたね。</pre>
<pre>heavenshell 18日 01:44:34: 今初めて知ったんですけど mustache って defunkt なんですね。知らなんだ。</pre>
<pre>tomoya 18日 01:44:42: まじか</pre>
<pre>mattn 18日 01:44:45: Go の html/template は結構文法が貧弱というか強くないというか貧相というか、シンプル(それだ)なので好き嫌いありそう。</pre>
<pre>heavenshell 18日 01:45:03: Mustache is Copyright (C) 2009 Chris Wanstrath</pre>
<pre>mattn 18日 01:45:30: 名前めっちゃひさびさ見た。</pre>
<pre>johejo 18日 01:45:34: helmのチャートとか読むのめんどくさいなとは思ったりします。</pre>
<pre>mattn 18日 01:45:51: ギッハブのしゃちょさん。</pre>
<pre>tomoya 18日 01:47:06: Atom本書いたから前書き頂戴ってメールしたら、ちゃんと返事くれた人だ（ごめん忙しいくて無理だけど嬉しいって言われた</pre>
<pre>mattn 18日 01:47:42: だいぶ前に社員と奥さんが揉めて、みたいな話だったかな(覚えてない)</pre>
<pre>johejo 18日 01:48:57: MSに買収されたときのブログで冒頭で軽くMSをディスってたのを思い出した</pre>
<pre>mattn 18日 01:49:58: なんにも活動してなかった。 <https://github.com/defunkt></pre>
<pre>heavenshell 18日 01:50:21: 流石にw</pre>
<pre>heavenshell 18日 01:50:40: 2009 年とかはすごいですねw</pre>
<pre>mattn 18日 01:51:46: 2004年に活動記録があった。 <https://github.com/mattn?tab=overview&amp;from=2004-12-01&amp;to=2004-12-31></pre>
<pre>mattn 18日 01:51:53: いつから GitHub やってんねん。</pre>
<pre>johejo 18日 01:52:28: そう考えるとmitchellh氏とかすごいなあ</pre>
<pre>mattn 18日 01:52:54: お箸の会社</pre>
<pre>heavenshell 18日 01:53:20: 経営しながらコード書くってすごいなぁ。自分には絶対無理だ。</pre>
<pre>mattn 18日 01:53:53: 受託ならまだしも自社製品すからね。</pre>
<pre>mattn 18日 01:54:10: 売り込みせんといかんし。</pre>
<pre>heavenshell 18日 01:54:23: そうですよねぇ。</pre>
<pre>mattn 18日 01:54:49: V さんもあんまコードは書いてないって言ってたなぁ。</pre>
<pre>johejo 18日 01:56:22: しかも自分の個人リポジトリもむっちゃメンテしてるし 何だこの人</pre>
<pre>heavenshell 18日 01:56:40: すごい</pre>
<pre>mattn 18日 02:00:45: hashicorp、500-1000 人くらい社員いるのか。</pre>
<pre>mattn 18日 02:01:07: (レンジ広い)</pre>
<pre>mattn 18日 02:01:34: まぁでも日本の社長さんならコード書ける規模じゃないな。</pre>
<pre>johejo 18日 02:03:01: private repoへのコントリビューションもかなり多いみたいだし普通にプロダクトコード書いてるっぽいっすね</pre>
<pre>tomoya 18日 02:04:02: HAL研時代の岩田さんみたいなもんか</pre>
<pre>lighttiger2505 19日 00:15:38: LSPの``workspace/executeCommand``仕様のふわふわ具合にどうしたものかと。
<https://microsoft.github.io/language-server-protocol/specifications/specification-current/#workspace_executeCommand></pre>
<pre>lighttiger2505 19日 00:20:49: vim-lspの `workspace/executeCommand` もReturnがAnyなので、何を返したものか状態なんですね。まあそうなりますよね。</pre>
<pre>mattn 19日 00:46:32: 逆にいうと独自で作るって話ですね。</pre>
<pre>lighttiger2505 19日 00:58:16: 綺麗にやろうとクライアント実装するなら各LSP側のexecuteCommand実装を見て、一通り捌けるようにしてあげる。雑にやるなら、どれも文字列で解釈できるものとして、バッファ表示してあげるかという感じですかね。</pre>
<pre>lighttiger2505 19日 00:59:29: sqlsのクエリ実行結果表示を作ってるのですが、出来たらvim-lsp側を触ってみます。</pre>
<pre>mattn 19日 01:01:26: 僕も前試したんですが code-action からの連携(register_command)でやるのはほぼ意味が無くて結局 `lsp#send_request` で直接 executeCommand 叩いて応答を JSON パースした方が楽でした。</pre>
<pre>mattn 19日 01:02:10: 速さを求めるなら Go 側で表作って Vim ではそれ表示するだけ、とかもあると思います。</pre>
<pre>mattn 19日 01:02:10: <https://github.com/olekukonko/tablewriter></pre>
<pre>lighttiger2505 19日 01:05:40: &gt;  速さを求めるなら Go 側で表作って Vim ではそれ表示するだけ、とかもあると思います
まさにそれでテーブル表示を作ろうとしていたところでした。</pre>
<pre> 19日 10:07:54: efm-langserver の completion-command に単語のみ抽出するコマンド作って設定してみた。日本語にも対応してしまったのでやっぱりちょっと遅いね。</pre>
<pre>mattn 19日 10:08:02: <https://github.com/mattn/words></pre>
<pre>johejo 19日 16:15:22: もしかしてefm-langserverとlookコマンドの組み合わせ悪くないのでは</pre>
<pre>tsuyoshi_cho 19日 16:19:02: すごいバックグラウンド負荷がw</pre>
<pre>tsuyoshi_cho 19日 16:19:07: でもよさげ</pre>
<pre>hrsh7th 19日 16:20:33: golang で ctags 的なものないんだろうかと調べてみたら <https://github.com/jstemmer/gotags> がでてきたけれど、更新されてなさげですね。。。</pre>
<pre>thinca 19日 16:21:26: ctags だと難しいのですっけ? Go の文法結構シンプルだし ctags でも割といけそうな雰囲気がするけど</pre>
<pre>hrsh7th 19日 16:21:32: _ていうか go のソースコードの解析しか対応していなかった_</pre>
<pre>hrsh7th 19日 16:22:04: あ、いえ、ctags 的なものを内蔵できてしまえば便利かなあと思っただけでした。</pre>
<pre>mattn 19日 16:23:19: ctags でユーザ定義できるのでそれでやってる人もいますね。</pre>
<pre>mattn 19日 16:23:40: ```--langdef=Go
--langmap=Go:.go
--regex-Go=/func([ \t]+\([^)]+\))?[ \t]+([a-zA-Z0-9_]+)/\2/d,func/
--regex-Go=/var[ \t]+([a-zA-Z_][a-zA-Z0-9_]+)/\1/d,var/
--regex-Go=/type[ \t]+([a-zA-Z_][a-zA-Z0-9_]+)/\1/d,type/```</pre>
<pre>tsuyoshi_cho 19日 16:23:58: いまのuctags強いので、わりとおまかせでいけそう...</pre>
<pre>mattn 19日 16:27:23: efm &amp; look は良さげ。</pre>
<pre>mattn 19日 16:27:32: hover に eblook とかも面白いかも。</pre>
<pre>tsuyoshi_cho 19日 16:28:47: eblookのための辞書定義とかですね、あとは</pre>
<pre>johejo 19日 16:29:10: `cat README.md | words | xargs -I{} look {}` とかやってみたけど結構遅かった...</pre>
<pre>mattn 19日 16:32:49: <https://docs.microsoft.com/ja-jp/visualstudio/releases/2019/release-notes#decompilation-extraction></pre>
<pre>mattn 19日 16:32:52: これすげーな。</pre>
<pre>mattn 19日 16:33:00: &gt; シンボルがなくてもマネージド コードを逆コンパイルし、コードの確認、変数の検査、ブレークポイントの設定を行うことができるようになりました。</pre>
<pre>tsuyoshi_cho 19日 16:33:34: さすがにマネージドコードなんですな</pre>
<pre>hrsh7th 19日 16:33:41: _書いてあることの意味すらわからなくてすごい_</pre>
<pre>kuu 19日 16:34:03: 公式で逆コンパイラ作ったのか</pre>
<pre>mattn 19日 16:34:05: IR からコードを戻してブレイクポイントを設定</pre>
<pre>johejo 19日 16:34:49: ちゃんともとの位置にブレイクポイントおけるんだ...</pre>
<pre>mattn 19日 16:35:25: デバッガでどこまでもステップインできるやつ。</pre>
<pre>mattn 19日 16:35:57: 「担当していた物が辞めてソースを紛失していたので助かった！」みたいな事言う人が出てきそう。</pre>
<pre>takets 19日 16:38:34: コードの復元ができてしまうのかなぁこれ</pre>
<pre>mattn 19日 16:39:00: java でいう jad</pre>
<pre>mattn 19日 16:39:35: 中間言語なので技術的には jad と同じですね。</pre>
<pre>hrsh7th 19日 16:41:55: バイナリだけあればブレークポイントまで貼れるってことなのかな。。。謎技術ですね。。。</pre>
<pre>johejo 19日 16:43:17: jd-guiちょっとだけ使ったことある</pre>
<pre>kuu 19日 16:43:24: 逆コンパイラというだけなら前からありましたけどね、ILSpyとか</pre>
<pre>kuu 19日 16:43:37: VSに入ってるというのがミソ</pre>
<pre>mattn 19日 16:44:35: eclipse も jad と連携してデバッガでステップイン可能でしたね。</pre>
<pre>mattn 19日 16:45:22: インタプリタなので walk する AST の前に break point 噛ませれば止まりそう。</pre>
<pre>hrsh7th 19日 16:45:27: （この手のものは）デバッグ専用のコードを差し込んだバイナリを作ってデバッグするもんだと想像していました。</pre>
<pre>mattn 19日 16:46:29: バイトコードインタプリタであればどれもできそう。</pre>
<pre>mattn 19日 16:53:50: ilspy って動かせるとこまでもどせましたっけ。</pre>
<pre>mattn 19日 16:55:04: ずいぶん昔にしか触ってないから動かせなかった記憶しかない。</pre>
<pre>mattn 19日 16:56:08: 有料ソフトウェアになってたw <https://www.red-gate.com/products/dotnet-development/reflector/></pre>
<pre>tyru 19日 17:12:31: Java なら多分前からできてそうですね &gt;ソースなくてもブレークポイント貼る
ソース無いコードデバッグしたことないけど。。</pre>
<pre>tyru 19日 17:13:33: IntelliJ, Eclipse でライブラリのメソッドとかにジャンプした際にソースない場合は逆コンパイルしたソースを見れるやつは vim でもほしい</pre>
<pre>tsuyoshi_cho 19日 17:15:35: debugger adapter期待(なにも考えていない)</pre>
<pre>tyru 19日 17:23:28: jump 先がなかったら jad かけるとかだったら案外できそうかも… いや対象 jar, class の特定がめんどいなー。
LSP 側に特定機能つけてもらわないとやってられんだろうし</pre>
<pre>tsuyoshi_cho 19日 17:24:18: lspでのジャンプについてはdebugger adapterとの連携IFがないとむずかしそうですね...</pre>
<pre>lighttiger2505 20日 00:08:54: <https://twitter.com/LightTiger2505/status/1240651715134644225?s=20></pre>
<pre>lighttiger2505 20日 00:09:46: なんとかLanguageServerでのSQL実行までこぎつけました。vim-lsp側の実装はちょっと考えないといけないですね。</pre>
<pre>tyru 20日 01:34:45: <https://vim-jp.slack.com/archives/CGABGC8LA/p1584635619031000></pre>
<pre>tyru 20日 01:34:53: <https://github.com/scalameta/metals/releases/tag/v0.8.2></pre>
<pre>mattn 20日 10:28:52: coc を色々試してるけど coc はなんかのパターン(まだわかってない)に入ると突然 LS が動かなくなる感じがする。vim-lsp の方が詳しいからかもしれないけど vim-lsp は負けてながらもカチッっと動いてる感じ。</pre>
<pre>mattn 20日 12:46:06: 補完候補の種別に coc ぽくアイコン付けてみた。</pre>
<pre> 20日 12:46:11: </pre>
<pre>mattn 20日 12:48:01: LspSettingsGlobalEdit してこれ貼り付ければこうなります。</pre>
<pre>mattn 20日 12:48:03: <https://gist.github.com/mattn/cb1a67992cadd5bc3ba51d2261078a6f></pre>
<pre>kuu 20日 12:48:36: 数学記号なのか、これ</pre>
<pre>kuu 20日 12:48:43: ポケモンのアンノーンにしか見えない</pre>
<pre>mattn 20日 12:50:37: アイコン、coc に合わせてみたけどなぜ「渚」が混じってるか分からん。</pre>
<pre>mattn 20日 12:51:16: この辺を vim-lsp 本体弄らずにできる様になってきた点で vim-lsp-settings の意味が出てきた。</pre>
<pre>mattn 20日 12:52:31: 本当は :file_folder: とか使った方がかっちょよさそうだけど。</pre>
<pre>mattn 20日 12:53:01: cica だと豆腐だらけになってしまった。</pre>
<pre>mattn 20日 12:53:16: coc のドキュメントによると nerdfont を使えとある。</pre>
<pre>mattn 20日 12:53:37: <https://www.nerdfonts.com/></pre>
<pre>tsuyoshi_cho 20日 12:55:46: Windowsでカラーemojiするには外すところがあるから、ですかね...
<https://miiton.github.io/Cica/></pre>
<pre>tsuyoshi_cho 20日 12:55:54: まあ、しょうがない...</pre>
<pre>takets 20日 13:02:08: AppleははやくヒラギノをNerdfont対応して</pre>
<pre>mattn 20日 13:08:44: モトヤも対応して</pre>
<pre> 20日 13:08:49: </pre>
<pre>mattn 20日 13:08:51: (´・ω・｀)</pre>
<pre>kuu 20日 13:09:44: フォント全然わからんのだけど、これパッチ必ず成功するわけじゃないのか</pre>
<pre>mattn 20日 13:10:09: どうなんでしょう。パッチあててないので。</pre>
<pre>kuu 20日 13:10:47: あー元からということか、この手の、作者が興味ないとどうしょうもないのでつらい</pre>
<pre>mattn 20日 13:11:13: <https://github.com/ryanoasis/nerd-fonts#font-patcher></pre>
<pre>mattn 20日 13:19:14: このリポジトリ、フォント含んでるから clone すると辛いなw</pre>
<pre> 20日 13:30:40: 純和風</pre>
<pre>mattn 20日 13:31:28: ```font-patcher
src/glyphs/devicons.ttf
src/glyphs/original-source.otf```
リポジトリからこれだけ落としてくれば動いた。</pre>
<pre>iwata 20日 14:13:31: Cicaに nerd-fontsのfont-patcherすればいいのかな</pre>
<pre>ycino 20日 14:25:54: Rictyあたりにpatchあてたやつならあるけどいります？</pre>
<pre>ycino 20日 14:26:08: Cicaは当ててなさそうだ</pre>
<pre>mattn 20日 14:26:34: fontforge だけインストールすれば↑の3つだけでパッチあてられます。</pre>
<pre>ycino 20日 14:26:44: 大分古いやつなんで、変わってないかはちょっと怪しいけど</pre>
<pre>ycino 20日 14:27:22: なんで当時の自分Cicaにはあててないんだろ、他は結構当ててるの置いてるのに</pre>
<pre>ycino 20日 14:29:11: （あとで消しておきます）</pre>
<pre>iwata 20日 14:36:00: patchは当てれたけどLspSettingsGlobalEdit設定しても補完候補に出てこなかった。asyncompleteだからかな</pre>
<pre>ycino 20日 14:51:47: Macでpatchしようとしても動いてくれない、Macが色々変わってるけど何したら動くんだろうこれ</pre>
<pre>ycino 20日 14:51:55: Dockerとかで環境整えた方が早い気がしてきた</pre>
<pre>mattn 20日 15:30:34: 僕も asyncomplete です。</pre>
<pre>ntak 20日 15:59:26: 以前話題にしたがっつり遅い Wi-Fi HDD でなおさらがっつり遅いのはなぜかという件、
SMBv1 でのファイルクエリがカーソル移動のたびに30-40件くらい出てそのハンドシェイクに時間を持っていかれているという落ちでして
ほんのちょっといじるだけでどばっと(ログが)
UNC パスに固定ドライブ名をつけると kernel32 あたりの動作ポリシーが変わるようです、手の施しようがありませんでした、トリアージ黒…</pre>
<pre>mattn 20日 16:04:15: どの契機でディスクアクセスに行ってるかちょっと知りたい感ある。</pre>
<pre>iwata 20日 16:42:11: fuzzy findのプラギン外したらでるかも、あとで試してみよ</pre>
<pre>mattn 20日 17:12:00: coc 使ってると空のポップアップが残る。</pre>
<pre> 20日 17:12:18: </pre>
<pre>ycino 20日 17:16:50: 自分もたまに残りますね
次に何か出せば消えるんで適当にfloating window出して消してたんですけど、vimだとpopupが消えないとか？</pre>
<pre>mattn 20日 17:18:10: 他に何も使ってないので coc が出してる何かだとは思うんですが。</pre>
<pre>mattn 20日 17:18:35: popup どこで出してるんだろ。こういう時 coc のデバッグ辛い。</pre>
<pre>johejo 20日 17:22:00: たしかcocはneovimのnode-clientをforkしてvim8に対応させてるんでしたっけ</pre>
<pre>mattn 20日 17:23:51: ```call popup_clear()```
という便利な物があった。</pre>
<pre>mattn 20日 18:04:06: どうやら coc は一度空っぽの popup を作って非同期でそこにテキストを埋め込んでるらしく、なんかのタイミングがずれると残る感じっぽい。</pre>
<pre>iwata 20日 21:08:44: だめでした</pre>
<pre>takets 20日 21:42:06: あらゆるフォントにパッチを雑に当てることができるやつ出ないものか</pre>
<pre>takets 20日 21:42:22: (  ；´。 ｀；)←fontforgeで挫折した顔文字</pre>
<pre>johejo 21日 00:31:54: vim-lsp-settingsでLspInstallServerしたあとにそのままlsp#activate()って呼べないのかな...</pre>
<pre>ntak 21日 01:16:27: <https://social.msdn.microsoft.com/Forums/sqlserver/en-US/07af330d-c949-4740-84c6-3e6ff5398f97/why-is-nets-fileopen-with-a-unc-path-making-excessive-smb-requests?forum=netfxbcl>
<https://ja.coder.work/so/c%23/137223>
このへんが近いでしょうか。ネットワークドライブェ…
一応、RAMディスクでもカーソル移動のたびにアクセスしているのは変わらないので、遅いRAMディスクだとカーソル移動も遅くなったりします。</pre>
<pre>mattn 21日 01:22:25: あ、はい。それは分かるのですが、vim-lsp からどのタイミングでディスクにアクセスに行ってるのかなぁと。</pre>
<pre>mattn 21日 01:24:57: ```let g:lsp_signature_help_enabled = 0```</pre>
<pre>mattn 21日 01:25:02: これで改善したりしますか？</pre>
<pre>kyoh86 21日 10:52:40: `call popup_clear()` しょっちゅう使うなあ</pre>
<pre>tsuyoshi_cho 21日 11:55:41: <https://vim-jp.slack.com/archives/CLKR04BEF/p1584757956065000>
 nexword、${LINE}のinputがあればefmで補完できそう...
もしくはフルにwrapするenglish-language-serverが作れそう的な &gt; nexword</pre>
<pre>tsuyoshi_cho 21日 11:55:54: <https://github.com/high-moctane/nextword></pre>
<pre>h-michael 21日 15:12:47: nvimのlspの方なのでvim-lspだと問題は起きないかもしれませんが、一応FYI
fugitive-vimで `Gedit` とかを使うと `fugitive:///home/h-michael/tmp/python/test/.git//0/main.py` みたいなfiletype=pythonなbufferを開いて、
lsp関係のautocomdがこれを引っ掛けて、そのごroot_dirがとれなくてエラーになるというissueを受けました。
どうしようかな〜。</pre>
<pre>ycino 21日 15:14:27: ファイルの実体以外のプロトコルは弾いちゃうとかですかね？</pre>
<pre>h-michael 21日 15:15:12: validationは入れているのではじけてはいるのですが、都度エラーメッセージでちゃうんですよね</pre>
<pre>ycino 21日 15:15:30: 判定するタイミングの問題・・・？</pre>
<pre>h-michael 21日 15:15:51: vim plugin作ってて悩ましいなって思うのはエラーメッセージ出して落とすのか出さずにスルーさせるのかの塩梅がいつも難しい。</pre>
<pre>ycino 21日 15:16:17: なるほど、エラー出さずに無効化するのがよくなさそうって感じですか</pre>
<pre>h-michael 21日 15:17:16: 通常利用していたらinvalidなroot_dir設定しているのだからちゃんとエラーだしたいんですよね。</pre>
<pre>ycino 21日 15:19:29: Ginaで似たようなことをしている気がするけど、cocでは多分エラー出さないようにしてるのかな</pre>
<pre>h-michael 21日 15:19:33: vim-lsp-settingとかもそうだと思うのですがたとえば[.git, package.json]とかを頼りに開いたbufferからroot_directoryをauto detectしてエラーになっているのと、
ユーザーがlspの設定を手書きしてそのroot_dirがinvalidなのってちょっとニュアンスちがうと思うんですよね。</pre>
<pre>ycino 21日 15:20:22: どっちで設定してるのかプラグイン側では判定できないと</pre>
<pre>h-michael 21日 15:22:06: ですね。auto detectしてる側で先に落とすようにするのがいいかと思うんですけど、fugitiveみたいに開けば絶対にroot_dirなんてないものと、単純にauto detectのロジックがわるかったのをどちらも同一にエラーはださないけど、スルーするっていうのはちょっといやだなと思いどうしようかなと。</pre>
<pre>h-michael 21日 15:30:17: こうしてみるとlsp云々というよりはいわゆるエラーハンドリングどうするか問題であるというだけだなと整理できました。ありがとうございます。</pre>
<pre>h-michael 21日 15:30:50: （より悩ましい問題になった気もする）</pre>
<pre>ycino 21日 15:30:59: 確かにlsp固有の問題ではなさそうですね
エラーハンドリングはどうするか難しい問題ですけど・・・</pre>
<pre>h-michael 21日 15:33:42: buffer typeがreadonlyなものはlspの起動対象外にしてもよさそうな気もするんですがなんかそれはそれできっと絶対に例外が出てきそう…</pre>
<pre>ycino 21日 15:35:30: ぱっと思いつかないけどありそうですねー</pre>
<pre>johejo 21日 15:54:38: もしかしてdefinitionで飛んだ先のライブラリのソースコードとかはreadonlyですかね？</pre>
<pre>h-michael 21日 15:56:16: そこはclient側の実装次第でどちらにもなり得ますね</pre>
<pre>tennashi 21日 16:28:11: <https://github.com/prabirshrestha/vim-lsp/blob/f79bf399220070123ca7642b318e5231843eb087/autoload/lsp.vim#L405-L409>
vim-lsp はここで `hoge://` な buffer 名はじいてそうですね</pre>
<pre>h-michael 21日 16:35:12: 画面上はエラーにせずにログにだけだしてる感じですね</pre>
<pre> 21日 16:45:29: vim-lsp-settingsで入れたvim-language-serverを使うと、floatingwindowが消えない。</pre>
<pre>takets 21日 16:46:02: PHPのintelephenseだと問題ないのになぁ</pre>
<pre> 21日 16:47:38: ウインドウがどんどん上書きされている感じだけれど、floatwindowを描画しているのはどのプラグインなんだろう</pre>
<pre>heavenshell 21日 16:50:02: vim-lsp?</pre>
<pre>takets 21日 16:52:56: たぶん他のプラグインが干渉しているから、最小環境で試してみます…</pre>
<pre>takets 21日 16:55:00: floatwindowが消えないというのは初めて遭遇するなぁ</pre>
<pre>tyru 21日 17:38:46: vim-lsp ぽい</pre>
<pre>kyoh86 21日 17:43:08: vim-lsp、結構floating windowとかで動こうとして変なことしている感がある</pre>
<pre>tsuyoshi_cho 21日 17:43:31: あ、
<https://github.com/high-moctane/asyncomplete-nextword.vim>
あったんか</pre>
<pre>kyoh86 21日 17:50:26: なんかの拍子にBufWipeoutがpopup windowに仕込まれちゃうんだよなぁ…

```Error detected while processing BufWipeout Autocommands for "*":
E994: Not allowed in a popup window```</pre>
<pre>kyoh86 21日 17:51:01: うるせ！ってなるししょっちゅうpopup_clear呼ぶのダルいからこれ解決したいけど再現して解決するには微妙に発生頻度が低くて困る…</pre>
<pre>mattn 21日 17:51:45: 僕が vim8 なので気付けてないな。</pre>
<pre>kyoh86 21日 17:51:58: 僕もvim8ですよ</pre>
<pre>kyoh86 21日 17:52:25: あ</pre>
<pre>kyoh86 21日 17:52:29: floatwindowの件か</pre>
<pre>mattn 21日 17:52:42: ですです。</pre>
<pre>kyoh86 21日 17:53:25: ひっこんどこ笑</pre>
<pre>takets 21日 17:54:44: neovimマンにはつらい流れ</pre>
<pre>mattn 21日 18:02:15: たぶん intelephense が signature help 対応してなくて vim-language-server が対応しててその差かなと推測してます。確認してないけど。たしかに今の vim-lsp の popup はよく分からないコードで動いてます。</pre>
<pre>takets 22日 09:17:06: nextwordを設定してみたけれど、妙なところで変換候補が消える。
`I have a bookshelf.` と入力したいのに、 `book` まで入力したら候補リストが消える。
あくまでよくあるパターンの入力に特化していて、lookみたいに単語を最後まで探してくれるものではない？</pre>
<pre>tsuyoshi_cho 22日 09:22:43: だと思いますねえ、そういう確定的な場合なら、vimの辞書補完とか使うほうが使えるんじゃないかなと</pre>
<pre>takets 22日 09:24:35: n-gramとか書いてあったので、薄々そんな気はしていました。
自分の用途だとneco-lookのほうがよさそう。
が、neco-lookはWindows環境だとたまに動作しない現象があったりするので、確実に動く環境で統一したい……</pre>
<pre>tsuyoshi_cho 22日 09:26:17: <https://github.com/gonzoooooo/asyncomplete-look.vim>
もあった...</pre>
<pre>takets 22日 09:31:38: coc.nvimにはない模様…</pre>
<pre>takets 22日 09:32:37: cocでlookが使えるなら、deopleteは日本語入力のみにチューニングできるのになぁ（地球上で10人もいなさそうな需要）</pre>
<pre>tsuyoshi_cho 22日 13:40:39: <https://qiita.com/high-moctane/items/c61fc54f5189ecb5de05>
解説</pre>
<pre>Shougo 22日 13:46:17: nextwordですけど、-gオプションがあって</pre>
<pre>Shougo 22日 13:46:41: これを使うと辞書代わりにもできますよ。デフォルトだと頻度が低い候補を一覧に出さないらしい</pre>
<pre>Shougo 22日 13:46:56: deoplete-nextwordでは対応しておきました</pre>
<pre>kuu 22日 13:47:46: この人文章書くの上手いなあ</pre>
<pre>tsuyoshi_cho 22日 13:48:01: 引数に足すか...</pre>
<pre>tsuyoshi_cho 22日 13:48:18: ちょっとバグ見付けたのでPRしないと</pre>
<pre>tsuyoshi_cho 22日 13:57:22: すでに来てた</pre>
<pre>lighttiger2505 22日 15:54:28: <https://twitter.com/LightTiger2505/status/1241619069708599296></pre>
<pre>lighttiger2505 22日 15:54:51: 作りました。READMEないから怒られそう。</pre>
<pre>lighttiger2505 22日 15:57:26: fzfのコールが思ったより面倒でした。いや自分でセレクタ作るよりはるかに簡単なんですけど。</pre>
<pre>ycino 22日 16:07:39: fzfのインターフェイス慣れないとだるそう</pre>
<pre>lighttiger2505 22日 16:16:23: fzfのインタフェースの`fzf#hogehoge`ってfzf.vimじゃなくてfzf本体にあったのか。とかこのインタフェースに渡す値なんやねんみたいなつまづきポイントいっぱいありますよね。あれ、どこかに明記されてるんですかね。</pre>
<pre>ycino 22日 16:21:59: 自分はwikiのサンプルとコード読んで頑張った気がする・・・</pre>
<pre>ycino 22日 16:22:23: fzf入れてたらfzf.vimいらないあたり罠ですよね、実はfzfの方にpluginディレクトリがあるとか気付かないし</pre>
<pre>lighttiger2505 22日 16:23:13: ですよね。なぜfzf.vimを作ったのにそっちにないのか。それならfzfだけで良いじゃないか感。</pre>
<pre>tsuyoshi_cho 22日 16:23:41: (deinでマージすると事故る... / 同位置に同名のファイル)</pre>
<pre>ycino 22日 16:23:44: （expectオプションを渡すかどうかで返ってくる値が違うとかも相当あれです）</pre>
<pre>tsuyoshi_cho 22日 16:24:29: ちゃんと操作APIだけ/インタフェースで分けてあるのかも微妙</pre>
<pre>kuu 22日 16:25:38: 同名のファイルが存在する時点でvimプラグインとしては競合してるのでマージ以前の問題である</pre>
<pre>ycino 22日 16:25:55: sinkに渡す関数に返ってくる配列が、expectオプションありだと `[key, ...selected_lines]` 、expectオプションなしだと `[...selected_lines]` になった気がしている</pre>
<pre>kuu 22日 16:26:09: 割とお行儀が悪い</pre>
<pre>ycino 22日 16:28:42: 自分はお行儀が悪いと思いつつ乗っちゃってるからあれなんですけど、もうちょっと綺麗になってると嬉しいですね・・・</pre>
<pre>ycino 22日 16:31:02: 自分のプラグインがfzfを更にwrapして頑張って使ってるので、もしかしたら少し参考になるかも？
逆によく分からなくて面倒になるかもですが</pre>
<pre>ycino 22日 16:33:27: あとfzf自体の引数とその使い方もそれなりに複雑、DBだとtableをリストに出してpreviweにschema表示させるとかよさそうな気がします</pre>
<pre>hrsh7th 22日 16:38:07: sqls.vim のコードを読んでみましたが、封印している execute_command 関数露出したほうがこういう連携しやすそうですね。</pre>
<pre>lighttiger2505 22日 16:47:14: <@U8R597E9H> CodeActionの選択肢を引数としてCodeActionに渡してあげて、選択肢をスキップしてExecuteCommand実行できても良いのかなと思いました。</pre>
<pre>hrsh7th 22日 16:48:39: その機能自体は提供されていますが、CodeAction.title に対するクエリではなく、CodeAction.kind に対するクエリになっています。（source.organizeImports などと指定する）</pre>
<pre>lighttiger2505 22日 16:49:01: なるほどあるんですね。気がつかなかった...</pre>
<pre>hrsh7th 22日 16:49:56: coc.nvim なんかは、指定されたコマンドを実行する関数を提供していたりしますので、それを vim-lsp にも提供するのはありかもなぁと思った次第でした。（今は private な関数として内部に存在はしてますが）</pre>
<pre>hrsh7th 22日 16:50:37: lsp#execute_command 的な形で…</pre>
<pre> 22日 16:50:54: </pre>
<pre>ycino 22日 16:50:56: それっぽいのができたー</pre>
<pre>hrsh7th 22日 16:51:18: fzf 自由度高杉</pre>
<pre>lighttiger2505 22日 16:51:39: ExecuteCommandは実行後の処理がわりとLanguageServerごとの色が強いので、ハンドル後の処理を柔軟に出来ないと厳しいですね。</pre>
<pre>hrsh7th 22日 16:52:25: 自分が lsp#execute_command を実装するなら必ず同期で実行されるようにしたくなる…。</pre>
<pre>ycino 22日 16:52:56: `mysql -u root -ppw -h 127.0.0.1 -N -s -e "show tables from table_name;" | fzf --preview="mysql -u root -ppw -h 127.0.0.1 -N -s -e 'show create table table_name.{};' | sed 's/\\\\n/\n/g'"`
こんなのでした、previewをvim内から実行するfzf#runのオプションに渡しちゃえばあんまり難しくないはず</pre>
<pre>hrsh7th 22日 16:52:57: でもそれは微妙な気がしていて I/F 固まってないので非公開になってます。</pre>
<pre>lighttiger2505 22日 16:53:14: ですね。ExecuteCommandを実行した結果を受け取って云々するは今のインタフェースだと結構辛い。</pre>
<pre>lighttiger2505 22日 17:00:25: sqls.vimは半分私の実験場みたいなもので、他のLSクライアント(VSCode含め)の動作を確認しながらいい具合のExecuteCommandの実装方法を探り、最終的にLSクライアントに寄せられればなと思ってます。</pre>
<pre>lighttiger2505 22日 17:02:08: 良いですね。解釈としてはlspのdocumentSymbolとしてテーブルを返してそれを見せても良さそう。</pre>
<pre>mattn 22日 23:51:26: sqls.vim よさそう。</pre>
<pre>hrsh7th 23日 16:24:58: rust-analyzer が一番仕様の追従に最近活発みたいでデバッグ捗りますね。</pre>
<pre>tsuyoshi_cho 23日 16:25:50: 心機一転しただけありますね</pre>
<pre>hrsh7th 23日 16:26:58: textDocument/selectionRange と、textDocument/onTypeFormatting に対応しててメジャーな言語の LS はこれくらいしか知らないです。</pre>
<pre>tsuyoshi_cho 23日 16:28:12: lsp、癖のない言語でリファレンス機能実装したものがないとつらたんですねえ...
(言語固有の考慮がないやつをリファレンスにほしい)</pre>
<pre>hrsh7th 23日 16:29:45: まったく触らない言語だとうまく動いてるかすらわからないので辛いです…</pre>
<pre>tsuyoshi_cho 23日 16:31:30: まあ、それもありますね...</pre>
<pre>hrsh7th 23日 16:33:02: selectionRange は早く他の LS も対応してほしいってくらい便利でした</pre>
<pre>kuu 23日 16:34:20: MSがちゃんとしたの出してくれていればいいのに</pre>
<pre>mattn 23日 16:40:21: 今の見本実装って typescript か gopls か、くらいな感じかな。</pre>
<pre>hrsh7th 23日 16:47:56: gopls はいい感じですね。typescript は tsserver は LSP ではないし、typescript-language-server は looking for new mainteiners 状態らしいです。。。</pre>
<pre>h-michael 24日 10:35:24: 自分はいつもrust-analyzerかgoplsでデバッグしてますねー</pre>
<pre>hrsh7th 24日 14:18:55: やっぱこの２つがよくできてますよね。gopls は安定しててそこそこ起動早いし、rust-analyzer はかなり最先端の仕様も取り込んでいて。。。

rust-analyzer の selectionRange は便利ですよ！</pre>
<pre>hrsh7th 24日 14:19:33: 自作クライアントを vim で使うとものすごく画面がチラついていて、それで自作クライアントのバグに気づいていくつも修正することになった。
なぜ nvim はチラつかなかったのかが少し不思議。。。</pre>
<pre>hrsh7th 24日 14:20:47: 結果的にすごく軽くなりました。</pre>
<pre>mattn 24日 15:15:18: <https://vim-jp.slack.com/archives/CJMV3MSLR/p1585030284124300></pre>
<pre>mattn 24日 15:20:31: vim-lsp の diagnostics は受けすぎなんだと思う。</pre>
<pre>mattn 24日 15:20:52: coc.nvim だとデフォルトではインサートモードで diagnostics は反映しないんですよね。</pre>
<pre>mattn 24日 15:21:14: vim-lsp は補完メニューで選んでる最中ですら反映する。</pre>
<pre>eihigh 24日 15:26:26: たしかに気になります。cocちゃんと触ってないけどcocの挙動の方が希望に近そう。</pre>
<pre>mattn 24日 15:27:27: せめて pumvisible 中は更新を送らなくていいと思う。</pre>
<pre>heavenshell 24日 15:39:26: 補完メニュー選び終わったら(確定したら)送っていいと思うけど、選んでる最中は鬱陶しい場合ありそうですね…。</pre>
<pre>mattn 24日 15:39:50: これのおかげでモサッとしてるのは確かにあるので。</pre>
<pre>hrsh7th 24日 15:44:51: この辺は好みがでてくるのでなかなか変更を提案するのも難しいですね。。。
mattn さんがおっしゃっている方式だと、TextChanged,InsertLeave だけ見ればよくなって、debounce などもあまりかけなくてよくなるかもしれません。</pre>
<pre>johejo 24日 15:45:23: 子供がテレビに集中してる間は休憩しても良いよってやつか</pre>
<pre>mattn 24日 15:46:00: diagnostics はサーバも加減してほしい。</pre>
<pre>mattn 24日 15:46:22: 全行送ってくるサーバあるからなぁ。</pre>
<pre>heavenshell 24日 15:47:36: LSP ではないけど tsserver がこれで困ってます…。いや tsuquyomi の方でバッファリングしろよって話なんですけど…。</pre>
<pre>hrsh7th 24日 15:48:42: InsertMode で diagnostics が増えるような変更は相当長く debounce してもいいんですよね。個人的には完全に止めてしまうのはそこまで好きではないですが。</pre>
<pre>tsuyoshi_cho 24日 15:48:53: せめて都度でも設定できれば、なんですがねぇ...(なにかで崩壊したときに全文もらって復旧はなくもない?)</pre>
<pre>johejo 24日 15:50:18: neovim built inはそのへんどんな感じなんだろう</pre>
<pre>mattn 24日 15:50:40: サーバからの通知を減らすにはこっちから更新を送らないようにしないといけない。</pre>
<pre>hrsh7th 24日 15:51:04: neovim-builtin は変更即時送信、diagnostics 即時反映。 なので結構ちらつきます。（特に virtual-text がちらつくのは不快）</pre>
<pre>hrsh7th 24日 15:52:14: じぶんは「変更送信→ 200ms debounce」「診断反映 → 増える変更の場合は約 1sec debounce、減る方向は即時反映」にしています。</pre>
<pre>johejo 24日 15:53:54: reactiveにしすぎるのもUX的にはだめなんだなあ.... ここらへん好みも分かれそうですね...</pre>
<pre>hrsh7th 24日 15:56:36: `Improve diagnostics` ってコミットをこの半年間何回もやっている気がする。。。だいぶ研究が進んできてはいるのでそろそろ持っていきたい。</pre>
<pre>mattn 24日 15:56:57: ちなみにどんな改善持ってらっしゃいます？</pre>
<pre>mattn 24日 16:03:19: <https://gist.github.com/5a683163b3f94a4920cec5ae472a2837></pre>
<pre>mattn 24日 16:03:25: これだけでも少し軽くなる気がしますね。</pre>
<pre>hrsh7th 24日 16:04:45: まず、変更送信の間隔に律速される仕組みなので、そこを早くしたいなあというのはあるのですが

1. 適用済み診断結果を 0 個として初期化する
2. 診断結果を受信すると、「適用済み診断結果」と「受信した診断結果」の個数を比較して、減っていれば即時 `適用`
3. 増えている場合、1sec 適用を遅延させる（この「遅延開始タイミング」の changedtick を一緒に保存しておく）
4. 遅延完了時に changedtick が変化していなければ `適用`
    - changedtick が変化していれば「後から診断がくるはず」なので無視する

※ `適用` 時に「適用済み診断結果」を更新する

こんな感じの処理に落ち着きつつあります。</pre>
<pre>mattn 24日 16:06:34: なるほど。diagnostics 1件ずつに changedtick 持たせてもいいかもですね。</pre>
<pre>hrsh7th 24日 16:08:40: <https://github.com/hrsh7th/vim-lamp/search?q=Improve+diagnostic&amp;type=Commits></pre>
<pre>hrsh7th 24日 16:09:06: 研究過程ですが、だいぶ固まっているはず。。。</pre>
<pre>mattn 24日 16:09:28: たぶん現状
1. 文字をタイプする (この時点では更新通知は flush されてない)
2. 補完が開始される (この時点で更新通知が flush される) → サーバが解析開始
3. 同時にサーバが補完メニューを用意
4. クライアントに補完メニューが表示され、最初の項目が選ばれテキストが変更される
5. 補完メニューでの変更によってサーバに更新通知が飛ぶ
6. ↑の2と同時に5の diagnostics がやってくる。
こんな感じかなぁと思っています。</pre>
<pre>mattn 24日 16:10:19: pumvisible 中だけでも切れると軽くなりそうな気がする。</pre>
<pre>mattn 24日 16:12:54: pumvisible 中に送らない様にすると
1. 文字をタイプする (この時点では更新通知は flush されてない)
2. 補完が開始される (この時点で更新通知が flush される) → サーバが解析開始
3. 同時にサーバが補完メニューを用意
4. クライアントに補完メニューが表示される
5. ↑の2の diagnostics がやってくるが捨てる
6. ポップアップが閉じられたら再度更新要求を飛ばす</pre>
<pre>tsuyoshi_cho 24日 16:14:22: 補完による最小文字とかの補填の動作での発動は抑止できたら、ですかね...想定内なんだから再diagは不要といえばそうですねえ</pre>
<pre>mattn 24日 16:14:52: そこは asyncomplete の方すね。</pre>
<pre>tsuyoshi_cho 24日 16:15:09: あー、そっちもか、なるほど</pre>
<pre>mattn 24日 16:15:36: diagnostics、量が多いから捨てても大してパフォーマンスに寄与しない場合がありそう。</pre>
<pre>mattn 24日 16:18:31: `foo.` みたいな状態で来た diagnostics って間違いなくエラーなんで捨てていいと思ったりします。</pre>
<pre>hrsh7th 24日 16:20:02: そこなんですよね。 `foo.` の状態で例えば 3sec くらいキーボード叩いてない時に、それでも「診断が表示されてほしくない」のか「いうても 3sec も放置したのだから診断出てほしい」のかが自分の中でも答えでてないです。。。</pre>
<pre>hrsh7th 24日 16:20:37: そこをスキップしていいならもはや InsertLeave だけを見て、その間は全部無視するでよくなってだいぶシンプルなんですよね。</pre>
<pre>hrsh7th 24日 16:22:30: `let g:lsp_diagnostics_suppress_on_insert_mode = 1` とかなら普通に通る気もしないでも。。。</pre>
<pre>tsuyoshi_cho 24日 16:22:50: CursorHoldI までいったら余裕があるから更新する、はオプションでアリナシあたりかな</pre>
<pre> 24日 17:02:13: vscode 速いすな。</pre>
<pre>hrsh7th 24日 17:03:33: 下波線だと意外と気にならないから耐えるってことなんだろうか。。。 vim だとどうしても赤字にしたりしないといけないので大仰になるかもですね。</pre>
<pre>hrsh7th 24日 17:04:25: virtual_text 出さなければ耐える気がしてきたかも。。。</pre>
<pre>h-michael 24日 17:04:58: 自分はnvimはvirtual text切ってますね</pre>
<pre> 24日 17:05:38: 言うほど大差ではないんですけどね。モサ感はありますね。</pre>
<pre>mattn 24日 17:06:21: 補完ががんばりすぎじゃない？って感じもする。</pre>
<pre>mattn 24日 17:07:39: これ1行だからあんま目立たないけど、これが50行とかだとモサーッとするんだろうなぁ。</pre>
<pre>hrsh7th 24日 17:08:49: あー。そうか、単純に負荷がってのはありそうですね。</pre>
<pre>heavenshell 24日 17:09:47: 大きいファイルで他でエラーが出てるのに、補完をしようとした時とかなんですかね。</pre>
<pre>mattn 24日 17:20:30: あと vim が flush するまでの delay が影響してそう。</pre>
<pre>mattn 24日 17:21:07: updatetime</pre>
<pre>hrsh7th 24日 17:21:23: 変更通知までの時間を短くしないとなーとうだうだしてましたが、diagnostics 改善やってみようかな。</pre>
<pre>mattn 24日 17:21:48: ファーッ、updatetime=500 とかしたら結構サクサクやw</pre>
<pre>hrsh7th 24日 17:22:16: でも質問者さんは「診断スピードをはやくしたい」と要望してきていたのか。。。それは現状だとちょっとつらい。。。</pre>
<pre>mattn 24日 17:23:45: 今の vim-lsp の flush のタイミングは
1. updatetime 経過する
2. 補完などアクションが発生する
のどちらかなんで、補完が更新されない様な数文字のタイプだと updatetime 待たされる感がある。</pre>
<pre>hrsh7th 24日 17:24:26: そうなんですよね。なので、listener_add or nvim_buf_attach が使える場合、そっちを利用して diff を取る。とかしないと流石にあの diff が短い間隔で走ると重い。。。</pre>
<pre>hrsh7th 24日 17:31:56: それにしても VSCode 狂った速さだ…</pre>
<pre>hrsh7th 24日 17:36:31: 診断を早くするためには、変更通知を早くする必要があり、変更通知は温かみのある diff で実装されているので、ここを改善しないといけないという理解です。</pre>
<pre>mattn 24日 17:37:22: あまり細かい diff やると負荷がもっと高くなるのでねー。</pre>
<pre>mattn 24日 17:37:41: listener 使ってごにょごにょできるならいいけど。</pre>
<pre>mattn 24日 17:38:09: 僕は updatetime 方面でなんか策がないか考えるか。</pre>
<pre>mattn 24日 17:38:38: 少なくとも updatetime のデフォルト値 4000 では長すぎる。</pre>
<pre>mattn 24日 18:26:40: 現状を整理しておくと、↑の vim の動画は
* updatetime 待ってしまっている
* asyncomplete が flush する事で更新通知が飛んでいるので updatetime まで待っていないケースもある
* でも asyncomplete がキャッシュしてるので全ての diagnostics が得られていない
遅く感じるのは、asyncomplete の delay も絡んでるはず。</pre>
<pre>mattn 24日 18:41:35: Split するかどうかで関数名の一部にズレがあるのは好き嫌いありそう。 <https://github.com/prabirshrestha/vim-lsp/pull/763></pre>
<pre>mattn 24日 18:41:48: LspDefinition vs LspSplitDefinition</pre>
<pre>hrsh7th 24日 19:01:30: LspDefinition split とかのほうがよかったりしないかなあ。（省略すると edit 扱い）コメントしてみます。</pre>
<pre>thinca 24日 19:04:49: それ私直そうと思ってたやつだな</pre>
<pre>johejo 24日 19:14:29: みんな自前でmappingしてるだろうな...</pre>
<pre>thinca 24日 19:16:12: 自前では無理なんですよね</pre>
<pre>thinca 24日 19:17:54: 似たような修正を入れようと思っていたのだけど(ただしもっと Vim way なやつ)、LSP の仕様を把握しきれていなくて `:LspXxx` のコマンド群の違いを理解できておらず、どのコマンドを対応させる必要があるのかわからなくなってそこで作業が止まっていた</pre>
<pre>hrsh7th 24日 19:19:46: `vsplit \| LspDefinition` ,,, （ただし、定義箇所が見つからなくても vsplit してしまう）</pre>
<pre>johejo 24日 19:20:30: こういうの私はやってました。  `nmap gs :split&lt;CR&gt;&lt;Plug&gt;(lsp-definition)`</pre>
<pre>thinca 24日 19:21:31: ジャンプ先がある時だけ分割ってのが既存のだと無理です</pre>
<pre>johejo 24日 19:21:58: あーなるほど.... 理解しました...</pre>
<pre>thinca 24日 19:29:29: もうちょっとだけマシな実装方法があるので急いでないのであればその分割コマンド進めるの待ってもらいたいのだが…いやまあ私がやる必要はないのか…</pre>
<pre>hrsh7th 24日 19:31:46: あそこにコメントすると変わったりするかも。。。（OSS でこういう時どうするのかいまいちわかってないです。。。）</pre>
<pre>tyru 24日 19:32:06: 俺以外に世界を救える方法は無いと思い込んでモチベを激上げするメソッド</pre>
<pre>thinca 24日 19:32:39: たぶん私が実装する前に誰かが進めてしまいそうなのでやり方だけ書き残しておこう…。
この手のことをやる場合は &lt;mods&gt; を使うのがセオリーです。
`:vertical LspDefinition` や `:tab LspDefinition` のようにコマンドを実行することができて、この前置部分をコマンド定義内の `&lt;mods&gt;` で取れます。こちらの方が Vim way だと思います。</pre>
<pre>thinca 24日 19:34:29: 手元で途中まで実装してたのだけど `LspDefinition` 系のコマンドがいくつかあることが途中でわかってどれが対応すべきコマンドなのか判断できませんでした</pre>
<pre>thinca 24日 19:35:01: LSP の仕様書結構量があってなかなか読み進められない</pre>
<pre>hrsh7th 24日 19:43:10: &lt;mods&gt; 使った場合、今 PR 上で提案されている `in_preview` やめて統一しましょう。についてはやらない方針になりそうですね。
横分割の場合は何を指定するんだろうこれ。。。</pre>
<pre>thinca 24日 19:46:03: belowright とかでいいのでは</pre>
<pre>thinca 24日 19:48:47: `:horizontal` があればいいのだけど…思えば標準のコマンドはその場で実行と分割実行だけはコマンド分かれているのよね `:edit` vs `:split`</pre>
<pre>tyru 24日 19:49:01: `&lt;mods&gt;` 便利
分割すべきかしないべきか (split か edit か) みたいなのは modifier では指定できなさそうだけど、そういうのはプラグイン側で踏み込んだオプションを用意するとかで良さそう</pre>
<pre>tyru 24日 19:49:27: 微妙にかぶった</pre>
<pre>thinca 24日 19:50:35: 実際に実装する場合は、 &lt;mods&gt; が空だったら `:edit` 、何か入ってたら `:&lt;mods&gt; split` を実行、みたいになるかな</pre>
<pre>thinca 24日 19:51:14: あとキーマッピングには対応できないけど、それくらい各位設定してくれでもいい気がする</pre>
<pre>hrsh7th 24日 19:51:28: mods が空なら edit で完全理解です。なるほど。</pre>
<pre>thinca 24日 19:52:05: どうせ &lt;Plug&gt; に対するキーマッピングはどのみちユーザーが定義する必要があるし。マッピング先が &lt;Plug&gt; か `:vert LspDefinition` かは大差がない…</pre>
<pre>hrsh7th 24日 19:52:56: 最近、特に意味がない場合はコマンド提供して &lt;Plug&gt; マッピング提供しないほうが筋よさそうだなあと思いつつあります。</pre>
<pre>thinca 24日 19:53:00: というのを途中までやってたんですけどね(まだ全然出せる段階じゃないけど)。手が遅いと何をやってもダメですね</pre>
<pre>thinca 24日 19:53:30: コマンドでできることをそのまま &lt;Plug&gt; 提供するのは意味ないなと私も感じております。</pre>
<pre>tyru 24日 19:53:31: 最近今更ながらプラグインのバッファを開く指定方法で良い方法ないかと考えてて、とりあえずプラグイン側は :sb 使って 'switchbuf' オプション指定してくれとか思ってたけど、こっちのがより行儀良い感じがする</pre>
<pre>hrsh7th 24日 19:54:38: _ちなみに自分はなんでも指定できるという意味で `LspDefinition split` 方式も結構好きです。。。_</pre>
<pre>thinca 24日 19:54:42: 他にも微妙に改善したいポイントが少なくとも1つある…まあこっちはたぶん誰もやらないだろ…黙っておこw</pre>
<pre>thinca 24日 19:55:48: 当面のタスクは LSP の仕様書を一通り読む、です。これができてないと vim-lsp は触れないなと思っている (ただし読むのは日本語訳である)</pre>
<pre>thinca 24日 20:05:54: 分割の件は週末までに特に進展がなさそうならなんとか作業を進めて別 PR 出そうかな。対応すべきコマンドは 4 つっぽいと言うのはわかったので</pre>
<pre>yaegassy 24日 20:18:52: 僕は定義ジャンプで(LspDefinition等他LSクライアントのも) で split のは当初は欲しかったのですが手癖で慣れてしまいました。やる方法があるってだけでもたしかにありがたい</pre>
<pre>yaegassy 24日 20:20:33: 類似した件になるかもですが LspDefinition で readonly で飛べたりしたら安全だなーって思うことはあります。ライブラリに飛んで保存しちゃってフォーマッターかかっちゃったりしてとか怖いときがあります。言語自体のライブラリ(goとかpythonとか)は更に怖い</pre>
<pre>daisuzu 24日 20:20:50: `&lt;mods&gt;` は便利ですね</pre>
<pre>kuu 24日 20:20:59: `:tab`みたいなの、ユーザーコマンドは未対応と思っていたけど、ちゃんと手は用意されているのか</pre>
<pre>yaegassy 24日 20:21:06: 逆にreadonlyでバッファの事故が発生しそうですが。。</pre>
<pre>daisuzu 24日 20:21:40: LspDefinitionでsplitしたくてそれっぽい設定をしようとしてたんですが、tagfuncでいいや...になっちゃいました</pre>
<pre>kuu 24日 20:22:08: ライブラリをchmodしておくと便利(面倒でやらなくなって忘れた頃に事故るやつ)</pre>
<pre>kuu 24日 20:23:54: helpはROになるのでそんな感じで合わせておくとよさそう(必要だったらsetすればいいし)</pre>
<pre>thinca 24日 20:24:29: `autocmd BufReadPost /path/to/library/* setlocal readonly`</pre>
<pre>thinca 24日 20:27:16: `/path/to/library/*` は `*/{vendor,node_modules}/*` みたいにすると汎用的になりそう</pre>
<pre>heavenshell 24日 20:59:15: 雑に site-package 以下のものをデバッグプリント仕込んだり、node_modules 以下のトランスパイル後のファイルに console.log 仕込んだりするマンです。
もちろん元戻しますけど(最悪ライブラリーを入れ直す)</pre>
<pre>yaegassy 24日 21:13:17: 標準ライブラリが怖いんですよね。</pre>
<pre>thinca 24日 21:14:59: 標準ライブラリまでジャンプで飛べる言語最近書いてない気がしてきた</pre>
<pre>yaegassy 24日 21:16:26: まー、といっても事故ったことはない気がしますが気がしてるだけなのかも。気をつける</pre>
<pre>heavenshell 24日 21:16:48: venv 作り直し :innocent:</pre>
<pre>kuu 24日 21:17:26: gitごと落としてくるやつならcheckoutすれば済むけどそうじゃないのつらそう</pre>
<pre>heavenshell 24日 21:18:02: 最近のライブラリーなら割とカジュアルに作り直せそうですね。</pre>
<pre>thinca 24日 21:18:20: まあでも標準ライブラリもどこかにファイルが置いてあるんであれば RO 設定するのはできるのでは?</pre>
<pre>heavenshell 24日 21:18:35: そすねー。</pre>
<pre>yaegassy 24日 21:18:36: Pythonのvenvってコピーされてるんじゃなくて本体に飛んじゃうので</pre>
<pre>heavenshell 24日 21:18:50: あれ、そうでしたっけ。</pre>
<pre>yaegassy 24日 21:18:53: そうですね。RO仕込めば不安がなくなるかも</pre>
<pre>heavenshell 24日 21:18:59: virtualenv マンだから気にしてなかったw</pre>
<pre>heavenshell 24日 21:19:32: じゃあまぁやっておいたほうが安心ですね。</pre>
<pre>hrsh7th 24日 21:24:12: rust-analyzer の onTypeFormatting や めっちゃくちゃ複雑な補完後の textEdit 処理などで三角測量的に TextEdit の実装がまともになってきました。</pre>
<pre>presuku 24日 22:43:06: daisuzu さんの tagfunc のおかげで LspDefinition は直接使わず、そのまま開きたい時は CTRL-] で 分割したい時は CTRL-W_] で開いた後、縦にしたい時は CTRL-W_L みたいな感じにやってますね</pre>
<pre>tsuyoshi_cho 24日 23:43:50: `確認したいです`
asyncompleteなんですが、ソースに vimのdictionary,thesaurusを引いてくるようなのってありましたっけ?(仕組み的に難しいかもですが...)</pre>
<pre>tsuyoshi_cho 24日 23:51:30: うーん、やっぱなさそう?</pre>
<pre>ycino 24日 23:53:32: 遠い昔にncm2のソースを書いた記憶があって見つかったんですが、asyncompleteと互換性って多分ないですよね・・・？</pre>
<pre>ycino 24日 23:55:26: ncm、asyncompleteが必要とかだった気がしたんだけど完全に気のせいっぽい</pre>
<pre>ycino 25日 00:48:08: なんか動くものできた気がする、 <@UAZ33BKV2> いらっしゃいます？</pre>
<pre> 25日 00:50:55: </pre>
<pre>ycino 25日 00:51:35: <https://github.com/yuki-ycino/asyncomplete-dictionary>
こんなのでいいのかな、asyncompleteの部分、他のプラグインからコード引っ張ってきてすごい雑にコピペしたから怪しい</pre>
<pre>mattn 25日 00:52:39: 補完が重たい感じがするの、foldingRange が飛んでるのも原因だな。</pre>
<pre>mattn 25日 00:52:52: pumvisible 中はオフったらまぁまぁ良くなった。</pre>
<pre>mattn 25日 00:57:31: 補完の popup が閉じた時のイベントって何かありましたっけ？</pre>
<pre>hrsh7th 25日 01:00:23: CompleteDone がそれとして使えます！</pre>
<pre>hrsh7th 25日 01:01:16: ただ、自動補完プラグイン発動中だとフィルタリングの度に発生するのでタイマーで余裕もたせて判定しないとうまくいかないかもしれません。</pre>
<pre>mattn 25日 01:02:29: それぽいですね。補完完了の時も発生するぽいので発生したタイミングで pumvisible() 見る感じですかね。</pre>
<pre>hrsh7th 25日 01:18:36: そうですね。pumvisible + timer くらいしか回避策なさそうです…</pre>
<pre>ntak 25日 03:02:06: 例の遅い HDD 上でも Insert モードではなく Replace モードで文字列を入力すると重くなく入力できることが判明したので
コードを見たところ Replace モードでは text_prop_frozen による補完抑止が効いていて、ふと Vim 本体側に debounce を仕込んでみようかと思い
実装の挿入位置を検討したところ lsp の知識がなかったのでなんとなく宙に浮いています。
あと vim-lsp のファイルクエリが速くないのではないか疑惑の件、clangd がルートフォルダまで設定ファイルを掘るのが原因のようです。
論理ドライブ単位のディスクキャッシュアプリを探して少し叩いてみます。</pre>
<pre>tsuyoshi_cho 25日 04:44:23: うお、ありがたい。
あとで見てみます。</pre>
<pre>tyru 25日 07:52:49: 解決できれば大分速くなりそう &gt;clangd</pre>
<pre> 25日 07:54:21: vim-lsp の sign でこんな感じに number の右に1桁エラーの色がはみ出てるんですが、バグですかね？(Vim の？ vim-lsp の？)</pre>
<pre>tyru 25日 07:54:56: 皆これ起きてないんだろうか</pre>
<pre>kuu 25日 07:56:12: goplsでは起きてるの見たことないですね</pre>
<pre>tyru 25日 07:57:33: ほんとだ、起きないですね…</pre>
<pre>tyru 25日 07:58:43: これエラー部分をハイライトしようとしてるけど範囲が間違ってるっぽいな（多分）
だとしたら vim-language-server か…</pre>
<pre>mattn 25日 08:10:21: 行全体の場合にカラムを 0 にしてるんじゃないですかね。</pre>
<pre>tyru 25日 08:21:32: それっぽいですね… vimlparser の syntax error なので手が回ってないのかも…</pre>
<pre>dadchyyy 25日 11:57:26: <https://asciinema.org/a/uodk43S5W6BRWANRkBE82HlpG></pre>
<pre>dadchyyy 25日 11:58:30: 動画撮ってたら意外と気にならないかもと思ってきましたが...とくにファイル開いた直後の診断が早くなると嬉しいと思いました</pre>
<pre>mattn 25日 12:00:14: 開いた直後は難しいかもですね。eclipse.jdt.js は起動から10～20秒するまで何もできない様ですね。ログ見ると progress 50% 60% みたいなのが出ます。</pre>
<pre>hrsh7th 25日 12:00:41: <@U010MDSRJU8> coc.nvim はファイル開いた後の診断も早いのでしょうか？</pre>
<pre>kuu 25日 12:00:58: Javaは読むもの多いから仕方ない</pre>
<pre>dadchyyy 25日 12:03:01: cocでも気持ち早いかな程度です、この辺は仕方なさそうですね！</pre>
<pre>mattn 25日 12:04:06: vim-lsp の補完は asyncomplete でしょうか？</pre>
<pre>dadchyyy 25日 12:04:46: asyncompleteです</pre>
<pre>heavenshell 25日 12:24:39: 普段遅い環境に慣れてるから、速いと思ってしまいましたw</pre>
<pre>mattn 25日 12:25:48: 少なくとも intellij や eclipse よりは速いw</pre>
<pre>mattn 25日 12:26:10: 影響するとしたら asyncomplete が発火する際の delay か、updatetime か、くらいかなぁ。</pre>
<pre>tsuyoshi_cho 25日 12:29:53: (昨日の改善の話題から)レスポンスという意味だと、キーを打ち始めた瞬間の次の応答の最速のポイントからupdatetimeの更新になるみたいな挙動だと負荷が少ないかなあ...?とか想像したりした
```|----|----|-|----|----| updatetime
|          ^ ^   ^   ^   ^   key stroke```
みたいな</pre>
<pre>mattn 25日 12:32:13: ひとまず pumvible の時は更新しないようなの書いてるけど、このケースに当てはまらない気がしてきた。 <https://gist.github.com/mattn/862cbc607fba4b32baea36eb92f9c2b0></pre>
<pre>hrsh7th 25日 12:37:06: _fold 使っていないのでアレなんですが_
この fold の止め方だと InsertLeave なんかで fold を再取得しないと更新されなくなってしまいそうな気がしました。</pre>
<pre>hrsh7th 25日 12:37:19: そしてちょっとびっくりなんですが
```    augroup lsp
        autocmd!
        autocmd BufNewFile * call s:on_text_document_did_open()
        autocmd BufReadPost * call s:on_text_document_did_open()
        autocmd BufWritePost * call s:on_text_document_did_save()
        autocmd BufWinLeave * call s:on_text_document_did_close()
        autocmd BufWipeout * call s:on_buf_wipeout(bufnr('&lt;afile&gt;'))
        autocmd InsertLeave * call s:on_text_document_did_change()
        autocmd TextChanged * call s:on_text_document_did_change()
        if exists('##TextChangedP')
            autocmd TextChangedP * call s:on_text_document_did_change()
        endif
        if g:lsp_diagnostics_echo_cursor || g:lsp_diagnostics_float_cursor || g:lsp_highlight_references_enabled
            autocmd CursorMoved * call s:on_cursor_moved()
        endif
        autocmd BufWinEnter,BufWinLeave,InsertEnter * call lsp#ui#vim#references#clean_references()
    augroup END```</pre>
<pre>hrsh7th 25日 12:37:38: vim-lsp むしろ TextChangedP だけ見てて TextChangedI は見てない説</pre>
<pre>tsuyoshi_cho 25日 12:39:10: おー</pre>
<pre>hrsh7th 25日 12:41:51: 個人的には mattn さんの gist の `timer_start(10` の部分を insert-mode の時は長くする。とかすれば快適になりそうな気がします。
あとは変更通知が早くなればノーマルモードの `x` とかではエラーが割と早く表示されるが、insert-mode の場合は結構待って反映されるという動きにできそう。</pre>
<pre>ycino 25日 15:01:15: あ、これ動きました？
1ファイルだけのほんとに最低限なんですけど</pre>
<pre>tsuyoshi_cho 25日 15:05:31: すんません、まだいそがしくて触れてません...</pre>
<pre>ycino 25日 15:06:28: 問題ないです、適当なタイミングで動いたかどうかだけでも書いてくれると助かるかもですー</pre>
<pre>ycino 25日 15:06:46: （むしろasyncomplete使ってなくて保守出来ない可能性ありそうだから引き取ってくれても）</pre>
<pre>tsuyoshi_cho 25日 15:09:11: できるかわかんないですけど、わかりますw。</pre>
<pre>ycino 25日 15:10:11: 1ファイルのリポジトリで30行ないので！</pre>
<pre>vikke 25日 17:18:42: vim-lsp-settingsで入れたlsp入れたんだけど、事あるごとにdeopleteが、gcode入れろと言ってくるのは、なにか設定が悪いのか？</pre>
<pre>Shougo 25日 17:25:12: deoplete-goを入れてるからでは</pre>
<pre>Shougo 25日 17:25:35: deoplete-goはgocodeに依存していてlsp使いませんよ</pre>
<pre>vikke 25日 17:31:53: 入ってた。あざいます。</pre>
<pre>vikke 25日 17:33:30: なんか色々とここはESPの巣窟だな。</pre>
<pre>h-michael 25日 17:44:36: だいたい作者がいる</pre>
<pre>Shougo 25日 17:49:07: なぜなら、似たような質問をしてきた人が最近いたからですね</pre>
<pre>Shougo 25日 17:49:24: おかげでESPできるようになってしまった</pre>
<pre> 25日 20:03:25: nvim v0.4.3 なんですけど、高確率で補完候補が画面にゴミとして残るんですけど、これ、同じ人いますか? プラギンは
```    call dein#add('prabirshrestha/async.vim')
    call dein#add('prabirshrestha/vim-lsp')
    call dein#add('mattn/vim-lsp-settings', {'merged': 0})
    call 'Shougo/deoplete.nvim'
    call dein#add('lighttiger2505/deoplete-vim-lsp')```
が関係しそうな所です。</pre>
<pre>luma 25日 20:14:10: 補完，LSPクライアント，同じ構成だと思います，僕も結構おこります</pre>
<pre>luma 25日 20:14:52: (coc.nvim使ってたときも残ることあったけど...)</pre>
<pre>vikke 25日 20:16:34: これ、起こると消えないんですよね。つらたん。</pre>
<pre>luma 25日 20:17:28: CTRL+W CTRL+Wをやってフォーカスして消してますね...</pre>
<pre>vikke 25日 20:17:50: なるほど。</pre>
<pre>kuu 25日 20:18:08: neovimだと手で個別に消せるんだったな（ふべんそう）</pre>
<pre>luma 25日 20:18:45: 諦めてゴミ消しmappingを用意しとく，とかが現実的なのかな（できるかな）</pre>
<pre>vikke 25日 20:20:51: C-W C-Wで消えない。。。</pre>
<pre>luma 25日 20:21:09: ん，フォーカスした後に `:q` したら消えませんか</pre>
<pre>vikke 25日 20:21:20: 消えないんですーーー</pre>
<pre>luma 25日 20:21:31: おえーわからない</pre>
<pre>vikke 25日 20:21:41: 完全にこびりついてる。。。</pre>
<pre>luma 25日 20:24:17: `call nvim_win_close(0, 1)`</pre>
<pre>vikke 25日 20:24:27: tmuxで縦分割したら、横にズレて、そのペインを閉じたら本に戻りおった。</pre>
<pre>vikke 25日 20:26:02: window閉じるけど、残る。。。newしたら新しいbufferにいる。</pre>
<pre>Shougo 25日 20:27:10: それポップアップウィンドウの消し忘れに見える</pre>
<pre> 25日 20:31:46: </pre>
<pre>luma 25日 20:53:05: まあ deopleteは関係なくて vim-lsp ですね多分</pre>
<pre>luma 25日 20:59:47: あくまで起きた後の対処でしかないですがこんなんで動きませんか

```function! CloseRemainedFloat()
  for win_id in nvim_tabpage_list_wins(0)
    let config = nvim_win_get_config(win_id)
    if get(config, 'relative') isnot ''
      call nvim_win_close(win_id, 1)
    endif
  endfor
endfunction

nnoremap &lt;silent&gt; &lt;C-L&gt; :&lt;C-U&gt;call CloseRemainedFloat()&lt;CR&gt;&lt;C-L&gt;```
</pre>
<pre>luma 25日 21:00:45: floatの判定の仕方あってるかわからない</pre>
<pre>monaqa 25日 21:02:31: 私は coc.nvim 使ってますが，少し前までは補完候補が残ることがたまにありましたね．最近はあまり起きないので，何らかの不具合が修正されたのかもしれません．</pre>
<pre>monaqa 25日 21:03:25: 間違って floating window の外にでちゃったときは `&lt;C-w&gt;p` で floating window の中に入り直せるんですが，補完ウィンドウだとそれは無理なんでしょうか</pre>
<pre>vikke 25日 22:07:57: あかん。goの勉強を阻害するので、coc.nvimに移行してみよう。</pre>
<pre>vikke 25日 22:54:19: coc.nvim入れて、vimrcイジるとこんなん言われる。
```[coc.nvim] error: Some plugin change completeopt on insert mode: 最後にセットしたスクリプト: ~/.cache/dein/.cache/init.vim/.dein/autoload/deoplete/mapping
.vim line 81!```
deopleteと干渉しあってる?</pre>
<pre>vikke 25日 23:22:58: deoplete抜いたら動いた。</pre>
<pre>ycino 26日 15:17:07: ありがとうございますー</pre>
<pre>daisuzu 27日 08:31:56: goplsのworkspace/symbolがCLIでも使えるようになったので当初欲しかった機能が一通り揃いました
<https://github.com/golang/tools/commit/d58d27dcbb58a087c15685124605e849e7b1789c></pre>
<pre>daisuzu 27日 08:32:20: ただ最大100件しか結果が返ってこないように制限がかかっているのでなんとかしたいところ...</pre>
<pre>ゴリラ 27日 09:02:02: さすが</pre>
<pre>heavenshell 27日 10:14:08: <https://twitter.com/sebmck/status/1243335551681363968?s=21|https://twitter.com/sebmck/status/1243335551681363968?s=21></pre>
<pre>heavenshell 27日 10:14:41: <https://twitter.com/sebmck/status/1243335552922832896?s=21|https://twitter.com/sebmck/status/1243335552922832896?s=21></pre>
<pre>heavenshell 27日 10:14:51: おお。</pre>
<pre>mattn 27日 10:16:47: rome 使った事なかった。</pre>
<pre>heavenshell 27日 11:02:28: rome って知らなかったです。リポジトリーどこなんでしょう？</pre>
<pre>mattn 27日 11:24:38: <https://romejs.dev/></pre>
<pre>mattn 27日 11:26:04: 安定の Sebastian McKenzie 案件だった。</pre>
<pre>mattn 27日 11:35:46: あ、まだ入ってない感じか。 <https://github.com/facebookexperimental/rome/pull/207></pre>
<pre>heavenshell 27日 12:21:20: お、ありがとうございます！</pre>
<pre>heavenshell 27日 12:21:28: 後で見てみよう</pre>
<pre>johejo 27日 12:23:53: typescript-language-serverが悲しいことになりかけてるので期待</pre>
<pre>mattn 27日 12:29:12: rome ドキュメント少なくて全然わからない。</pre>
<pre>mattn 27日 12:29:45: キレときます？「こんにゃ rome」って。(既視感)</pre>
<pre>johejo 27日 12:30:55: とりあえずツールチェーン全部作り直す.... らしい</pre>
<pre>lambdalisue 27日 12:48:32: js のツールチェーン全部作り直すのやばい</pre>
<pre>heavenshell 27日 12:52:40: sebmck なら出来そうw</pre>
<pre> 28日 13:43:26: いろいろ手を入れて、こうなったけど... asyncompleteのinfoの領域って該当する単語をマスクする機能でもあるのだろうか?</pre>
<pre>tsuyoshi_cho 28日 13:49:55: あと重くて常用には耐えないw</pre>
<pre>ycino 28日 15:47:48: PR来てたー、ありがとうございます <@UAZ33BKV2></pre>
<pre>ycino 28日 15:48:45: どうしましょう
自分の最初のコードがあってないようなものなんで、そっちでリポジトリ作って貰っても全然いいんですけど</pre>
<pre>tsuyoshi_cho 28日 15:48:58: どうしましょうかね?</pre>
<pre>tsuyoshi_cho 28日 15:49:15: とりあえずOKだったら、くらいで入れてもいいかと思いますがw</pre>
<pre>tsuyoshi_cho 28日 15:49:28: 自分はforkいじってればいいかな、くらいw?</pre>
<pre>ycino 28日 15:50:15: あ、これ入れるのは全く問題ないです
なんか自分があまりにも放置してたら必要に応じてまた扱い考えるとかにしますか</pre>
<pre>tsuyoshi_cho 28日 15:51:10: まあ、まだ言語の選択とか、キャッシュの最適化とか気にしないといけないところはおおいですしね...
そして辞書がデカいと重いですねえ...</pre>
<pre>ycino 28日 15:51:52: あー、辞書が大きいだけで重いんですね
こういう場合の最適化の知識全くなくてあれだ・・・</pre>
<pre>tsuyoshi_cho 28日 15:52:43: 補完のとき、1文字目から依頼がきますが、その時に辞書の1/26くらいをぶっこむことになりますから...</pre>
<pre>tsuyoshi_cho 28日 15:53:15: 3文字目くらいまでなんも出さないほうが軽くなるかなあ...(オプション設定にすればいいかな?)</pre>
<pre>ycino 28日 15:53:19: 2-3文字目から使うようにmatcher設定するとかですかね？</pre>
<pre>ycino 28日 15:53:26: やっぱりそれですよねー</pre>
<pre>tsuyoshi_cho 28日 15:54:10: あと、初回のロードをどうにか陰蔽できるといいけど、じゃないと最初の補完発動で10数秒はとまるのでw</pre>
<pre>ycino 28日 15:54:35: そんなに辞書大きいんですね、それは厳しい</pre>
<pre>tsuyoshi_cho 28日 15:55:08: <http://www.namazu.org/~tsuchiya/sdic/data/gene.html>
から変換したのを入れた(はず)</pre>
<pre>tsuyoshi_cho 28日 15:55:29: 項目が11000くらい?</pre>
<pre>ycino 28日 15:55:44: うわ、11000でその遅さは流石に無理だ</pre>
<pre>tsuyoshi_cho 28日 15:56:06: デバッグ途中の値だかなので、ちょっと再確認...</pre>
<pre>ycino 28日 15:56:57: vim.dictが1500ちょいか、手元で特に引っかからなかったんでまぁまぁいけるのかと思ってそれ以上何もやってなかったんですよね</pre>
<pre>ycino 28日 15:57:20: vitalとのパフォーマンスの差もちょっと気になるかも</pre>
<pre>tsuyoshi_cho 28日 15:57:56: まちがい 114741行だった</pre>
<pre>ycino 28日 15:58:23: 11万行だと100倍かー、手元で0.1秒だったのが10秒になるって聞くとまぁ納得ですね・・・</pre>
<pre>tsuyoshi_cho 28日 15:59:30: とはいえ、補完が途中からだとわりと実用的だった。辞書として説明出すようにしたしw</pre>
<pre>tsuyoshi_cho 28日 15:59:47: その辺はnextwordにないところ</pre>
<pre>tsuyoshi_cho 28日 16:00:45: 次は、matcherのパラメタと、遅延詠み込み(できたら)と、言語ごとの対応と、辞書-言語対応かなあ</pre>
<pre>ycino 28日 16:01:31: たくさんあるなぁ</pre>
<pre>tsuyoshi_cho 28日 16:01:45: まあ、希望だけならタダなのでw</pre>
<pre>ycino 28日 16:01:45: まずはファイル開いたときの非同期キャッシュ生成とかですかね</pre>
<pre>tsuyoshi_cho 28日 16:01:51: とりあずマッチャーなおすか</pre>
<pre>ycino 28日 16:02:22: 重さ聞いてるとmatcherとキャッシュ生成でパフォーマンス上げるのが最優先感ありますね</pre>
<pre>ycino 28日 16:06:19: dictionary-language-serverを作ってしまう・・・？</pre>
<pre>tsuyoshi_cho 28日 16:07:18: ちなみに vim.dict って入手はどこからなんですっけ?
あまり正道を勉強してなかったので、そこらへんわからないという...</pre>
<pre>ycino 28日 16:07:59: すみません、自分もこれどこで拾ったか怪しいやつです
使ってなかったんですけど、大分昔にdotfilesに入れてたのが残ってた感じ</pre>
<pre>tsuyoshi_cho 28日 16:59:09: なるほど...</pre>
<pre>thinca 28日 18:40:09: <@U8R597E9H> cc: <@U03C6TEAZ>
`&lt;mods&gt;` サポート書いてみました (まだ PR は出していません)
<https://github.com/thinca/vim-lsp/tree/add-mods-support>
実を言うとこれを実プラグインに適用するのは初めてなんですが、実際に使ってみた感想としては、単純に `split` のみしたい場合にどうすればいいのか直感的にはわかりづらいですね。
`:leftabove` か `:rightbelow` を使えばできるんですが、無引数の `:split` (分割方法は `'splitbelow'` オプションに依存する) を再現するいい感じの方法がないです。
(mods の中身のチェックをしていないので、一応全く関係のないオプション `:silent` とかを渡すとできますが…裏技チック)
細かいところを気にしなければ十分便利だとは思いますが、意見を頂きたいです &gt;all</pre>
<pre>thinca 28日 18:42:28: `:horizontal` があれば色々気持ち悪さ払拭できそう…</pre>
<pre>thinca 28日 18:45:02: ついでに該当コード周辺のリファクタリングをしたが…テストがない…</pre>
<pre>hrsh7th 28日 19:26:38: 個人的には引数で edit/split/vsplit が渡せるほうが直感的なのかなぁという判断ではあります。なにか、Vim way にすることでメリットがあればいいのですが、本件については思い浮かばないのですよね…</pre>
<pre>thinca 28日 19:28:28: 引数を将来別のことに使える可能性は一応ありますが…</pre>
<pre>hrsh7th 28日 19:28:53: なるほど。たしかに他の用途に残せるというのはメリットですね。</pre>
<pre>hrsh7th 28日 19:29:59: horizontal があれば直感的だったのに…というのは同意です。（そもそも自分はやり方知らなかったくらいなので）</pre>
<pre>thinca 28日 19:33:53: この際引数でもいいんですがその場合は mods と同等の自由度は確保してほしいです</pre>
<pre>hrsh7th 28日 19:36:35: leftabove や rightbelow を指定可能ってことでしょうか。結構めんどうそうな気がしますね。。意外と簡単なんだろうか。</pre>
<pre>thinca 28日 19:42:28: コマンドだけなら (マッピングは気にしなければ) そんなに大変ではないです</pre>
<pre>hrsh7th 28日 19:51:38: であればそちらの方針もありかもですね。全パターン向けの
マッピングはさすがに苦しい…</pre>
<pre>tsuyoshi_cho 28日 20:58:21: すみません、asyncompleteの挙動なのですが、C-eにasyncomplete#cancel_popup() がマップされてる状態での録画です。
キャンセルした後、スペースの入力で再度補完が表示されてますが、これって期待動作でしたっけ?
<https://gyazo.com/e028bb17c6f6ee17d71b3bebf50cbe51></pre>
<pre>tsuyoshi_cho 28日 20:58:52: 録画がみにくい...
環境依存だとしたらもうしわけないです</pre>
<pre>johejo 29日 06:18:24: hashicorp公式？のterraformのlanguage server <https://github.com/hashicorp/terraform-ls></pre>
<pre>dohq 29日 06:41:20: うぉ、公式で出したのか
juliosueiras氏のどうなるかなぁ…</pre>
<pre>johejo 29日 06:55:31: vim-lspで起動してみたけどうまく動かないなあ...
</pre>
<pre>johejo 29日 06:55:31: ```Sun 29 Mar 2020 06:51:55 AM JST:["lsp#register_server","server registered","efm-langserver"]
Sun 29 Mar 2020 06:51:55 AM JST:["lsp#register_server","server already registered","efm-langserver"]
Sun 29 Mar 2020 06:51:55 AM JST:["lsp#register_server","server registered","efm-langserver"]
Sun 29 Mar 2020 06:51:55 AM JST:["lsp#register_server","server registered","terraform-ls"]
Sun 29 Mar 2020 06:51:55 AM JST:["vim-lsp signs enabled"]
Sun 29 Mar 2020 06:51:55 AM JST:["vim-lsp highlighting enabled (textprop)"]
Sun 29 Mar 2020 06:51:55 AM JST:["s:on_text_document_did_open()",1,"terraform","/home/heijo","file:///home/heijo/main.tf"]
Sun 29 Mar 2020 06:51:55 AM JST:["Starting server","terraform-ls",["/home/heijo/go/bin/terraform-ls","serve"]]
Sun 29 Mar 2020 06:51:55 AM JST:[{"response":{"data":{"__data__":"vim-lsp","lsp_id":1,"server_name":"terraform-ls"},"message":"started lsp server successfully"}}]
Sun 29 Mar 2020 06:51:55 AM JST:["---&gt;",1,"terraform-ls",{"method":"initialize","params":{"rootUri":"file:///home/heijo","initializationOptions":null,"capabilities":{"workspace":{"configuration":true,"applyEdit":true},"textDocument":{"implementation":{"linkSupport":true},"documentSymbol":{"symbolKind":{"valueSet":[10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,1,2,3,4,5,6,7,8,9]},"hierarchicalDocumentSymbolSupport":false},"semanticHighlightingCapabilities":{"semanticHighlighting":false},"codeAction":{"codeActionLiteralSupport":{"codeActionKind":{"valueSet":["","quickfix","refactor","refactor.extract","refactor.inline","refactor.rewrite","source","source.organizeImports"]}},"dynamicRegistration":false},"completion":{"completionItem":{"snippetSupport":false,"documentationFormat":["plaintext"]},"completionItemKind":{"valueSet":[10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,1,2,3,4,5,6,7,8,9]}},"foldingRange":{"lineFoldingOnly":true},"typeDefinition":{"linkSupport":true},"typeHierarchy":false,"declaration":{"linkSupport":true},"definition":{"linkSupport":true}}},"rootPath":"/home/heijo","processId":821,"trace":"off"}}]
Sun 29 Mar 2020 06:51:55 AM JST:["&lt;---",1,"terraform-ls",{"response":{"id":1,"jsonrpc":"2.0","error":{"code":-32602,"message":"invalid parameters: [-32602] invalid parameters: json: unknown field \"typeHierarchy\""}},"request":{"id":1,"jsonrpc":"2.0","method":"initialize","params":{"rootUri":"file:///home/heijo","initializationOptions":null,"capabilities":{"workspace":{"configuration":true,"applyEdit":true},"textDocument":{"implementation":{"linkSupport":true},"documentSymbol":{"symbolKind":{"valueSet":[10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,1,2,3,4,5,6,7,8,9]},"hierarchicalDocumentSymbolSupport":false},"semanticHighlightingCapabilities":{"semanticHighlighting":false},"codeAction":{"codeActionLiteralSupport":{"codeActionKind":{"valueSet":["","quickfix","refactor","refactor.extract","refactor.inline","refactor.rewrite","source","source.organizeImports"]}},"dynamicRegistration":false},"completion":{"completionItem":{"snippetSupport":false,"documentationFormat":["plaintext"]},"completionItemKind":{"valueSet":[10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,1,2,3,4,5,6,7,8,9]}},"foldingRange":{"lineFoldingOnly":true},"typeDefinition":{"linkSupport":true},"typeHierarchy":false,"declaration":{"linkSupport":true},"definition":{"linkSupport":true}}},"rootPath":"/home/heijo","processId":821,"trace":"off"}}}]
Sun 29 Mar 2020 06:51:55 AM JST:["---&gt;",1,"terraform-ls",{"method":"initialized","params":{}}]
Sun 29 Mar 2020 06:51:55 AM JST:["&lt;---(stderr)",1,"terraform-ls",["2020/03/29 06:51:55 service.go:56: Preparing new service ...","2020/03/29 06:51:55 langserver.go:65: Starting server (pid 827) ...","2020/03/29 06:51:55 server.go:469: Received 1 new requests","2020/03/29 06:51:55 server.go:165: Processing 1 requests","2020/03/29 06:51:55 server.go:223: Checking request for \"initialize\": {\"rootUri\":\"file:///home/heijo\",\"initializationOptions\":null,\"capabilities\":{\"workspace\":{\"configuration\":true,\"applyEdit\":true},\"textDocument\":{\"implementation\":{\"linkSupport\":true},\"documentSymbol\":{\"symbolKind\":{\"valueSet\":[10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,1,2,3,4,5,6,7,8,9]},\"hierarchicalDocumentSymbolSupport\":false},\"semanticHighlightingCapabilities\":{\"semanticHighlighting\":false},\"codeAction\":{\"codeActionLiteralSupport\":{\"codeActionKind\":{\"valueSet\":[\"\",\"quickfix\",\"refactor\",\"refactor.extract\",\"refactor.inline\",\"refactor.rewrite\",\"source\",\"source.organizeImports\"]}},\"dynamicRegistration\":false},\"completion\":{\"completionItem\":{\"snippetSupport\":false,\"documentationFormat\":[\"plaintext\"]},\"completionItemKind\":{\"valueSet\":[10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,1,2,3,4,5,6,7,8,9]}},\"foldingRange\":{\"lineFoldingOnly\":true},\"typeDefinition\":{\"linkSupport\":true},\"typeHierarchy\":false,\"declaration\":{\"linkSupport\":true},\"definition\":{\"linkSupport\":true}}},\"rootPath\":\"/home/heijo\",\"processId\":821,\"trace\":\"off\"}","2020/03/29 06:51:55 rpc_logger.go:29: Incoming request for \"initialize\" (ID 1): {\"rootUri\":\"file:///home/heijo\",\"initializationOptions\":null,\"capabilities\":{\"workspace\":{\"configuration\":true,\"applyEdit\":true},\"textDocument\":{\"implementation\":{\"linkSupport\":true},\"documentSymbol\":{\"symbolKind\":{\"valueSet\":[10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,1,2,3,4,5,6,7,8,9]},\"hierarchicalDocumentSymbolSupport\":false},\"semanticHighlightingCapabilities\":{\"semanticHighlighting\":false},\"codeAction\":{\"codeActionLiteralSupport\":{\"codeActionKind\":{\"valueSet\":[\"\",\"quickfix\",\"refactor\",\"refactor.extract\",\"refactor.inline\",\"refactor.rewrite\",\"source\",\"source.organizeImports\"]}},\"dynamicRegistration\":false},\"completion\":{\"completionItem\":{\"snippetSupport\":false,\"documentationFormat\":[\"plaintext\"]},\"completionItemKind\":{\"valueSet\":[10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,1,2,3,4,5,6,7,8,9]}},\"foldingRange\":{\"lineFoldingOnly\":true},\"typeDefinition\":{\"linkSupport\":true},\"typeHierarchy\":false,\"declaration\":{\"linkSupport\":true},\"definition\":{\"linkSupport\":true}}},\"rootPath\":\"/home/heijo\",\"processId\":821,\"trace\":\"off\"}","2020/03/29 06:51:55 rpc_logger.go:45: Error for \"initialize\" (ID 1): [-32602] invalid parameters: [-32602] invalid parameters: json: unknown field \"typeHierarchy\"","2020/03/29 06:51:55 server.go:204: Completed 1 requests [590.231µs elapsed]","2020/03/29 06:51:55 server.go:469: Received 1 new requests","2020/03/29 06:51:55 server.go:165: Processing 1 requests","2020/03/29 06:51:55 server.go:223: Checking request for \"initialized\": {}",""]]
Sun 29 Mar 2020 06:51:55 AM JST:["&lt;---(stderr)",1,"terraform-ls",["2020/03/29 06:51:55 rpc_logger.go:29: Incoming notification for \"initialized\": {}",""]]```</pre>
<pre>johejo 29日 07:22:55: TextDocumentClientCapabilitiesにtypeHierarchyなんてあったのか... 仕様書にみあたらない...
これか <https://github.com/microsoft/language-server-protocol/issues/468></pre>
<pre>thinca 31日 21:08:21: とりあえず PR を出すだけ出したので後はお好きに。閉じてもらっても大丈夫。
<https://github.com/prabirshrestha/vim-lsp/pull/776></pre>
<pre>mattn 31日 21:33:08: <https://github.com/prabirshrestha/vim-lsp/pull/776/files#diff-3743411c94af62c4459d91bf5f5a9597R69></pre>
<pre>mattn 31日 21:33:10: なんだこれ</pre>
<pre>tyru 31日 21:36:51: :function! の ! のつけ忘れですね</pre>
<pre>thinca 31日 21:39:03: oh... vim-lsp は古い Vim 向けのコード規約なのか…</pre>
<pre>thinca 31日 21:39:55: snippet から `!` 消してしまったので古いプラグイン向けにコード書く時に割とハマる</pre>
<pre>tyru 31日 21:40:43: vint のメッセージも一応修正されたんですが、古い vint 使ってるみたいですね。
<https://github.com/Vimjas/vint/issues/232></pre>
<pre>tyru 31日 21:41:33: vim-lsp ってより vint 自体がまだサポートしてないような <https://github.com/Vimjas/vint/issues/322></pre>
<pre>tsuyoshi_cho 31日 21:41:42: 新vintへのPRチャンス？</pre>
<pre>tyru 31日 21:42:57: ↑のリンクミスってた、232 がメッセージの修正、322 が vint で現状 ! と abort のチェックが一緒になっているのを abort 単体でチェックするという issue です</pre>
<pre>thinca 31日 21:43:45: `!` 直しました (force push)</pre>
{% endraw %}
